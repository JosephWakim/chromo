

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial 3: One-Mark Chromatin &mdash; chromo  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="chromo  documentation" href="index.html"/>
        <link rel="next" title="Tutorial 4: Two-Mark Chromatin" href="tutorial_4_two_mark_chromatin.html"/>
        <link rel="prev" title="Tutorial 2: Confined, Semiflexible Homopolymer" href="tutorial_2_confined_semiflexible_homopolymer.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> chromo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="abstract.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_structure.html">Code Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="mc_sim.html">Monte Carlo Simulations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="poly_models.html">Polymer Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="field.html">Field Theoretic Treatment of Interactions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial_1_unconfined_semiflexible_homopolymer.html">1. Unconfined, Semiflexible Homopolymer</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_2_confined_semiflexible_homopolymer.html">2. Confined, Semiflexible Homopolymer</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Single-Mark Chromatin Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Import-Modules">Import Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specify-Binders">Specify Binders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specify-the-Confinement">Specify the Confinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Instantiate-Epigenetic-Mark-Pattern">Instantiate Epigenetic Mark Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specify-Initial-Reader-Protein-Binding-States">Specify Initial Reader Protein Binding States</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Instantiate-the-Polymer">Instantiate the Polymer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specify-the-Uniform-Density-Field">Specify the Uniform Density Field</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specify-the-Simulation-Parameters">Specify the Simulation Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Run-the-Simulation">Run the Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-the-Resulting-Configuration">Plot the Resulting Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_4_two_mark_chromatin.html">4. Two-Mark Chromatin Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_5_two_mark_chromatin_competitive.html">5. Two-Mark Chromatin Simulation with Competitive Binding</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_6_two_step_refinement.html">6. Simulation with Coarse and Refined Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_7_kinked_chromatin.html">7. Kinked Chromatin Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_8_kinked_chromatin_with_sterics.html">8. Kinked Chromatin Simulation with Sterics</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_snippets.html">Code Snippets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">chromo</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial 3: One-Mark Chromatin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial_3_one_mark_chromatin.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Tutorial-3:-One-Mark-Chromatin">
<h1>Tutorial 3: One-Mark Chromatin<a class="headerlink" href="#Tutorial-3:-One-Mark-Chromatin" title="Permalink to this heading">¶</a></h1>
<p>Tutorials 1 and 2 introduce homopolymer simulations with <code class="docutils literal notranslate"><span class="pre">chromo</span></code>. This tutorial will demonstrate the simulation of a nucleosome-resolution chromatin fiber with one epigenetic mark, specifically H3K9me3. Descriptions in this notebook will highlight additions to the code from the previous tutorials.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="Import-Modules">
<h2>Import Modules<a class="headerlink" href="#Import-Modules" title="Permalink to this heading">¶</a></h2>
<p>Since we are modeling chromatin instead of an arbitrary SSWLC, we will import the <code class="docutils literal notranslate"><span class="pre">Chromatin</span></code> class from the <code class="docutils literal notranslate"><span class="pre">polymers</span></code> module. The chromatin fiber in this demonstration will be modified by H3K9me3, which is preferentially bound by HP1 reader proteins. Once bound HP1 reader proteins can interact with one-another. Interactions between reader proteins are captured with a uniform density field, which is implemented in the <code class="docutils literal notranslate"><span class="pre">UniformDensityField</span></code> class of the <code class="docutils literal notranslate"><span class="pre">fields</span></code> module. While beads in
this demonstration represent individual nucleosomes, steric interactions between the beads are not explicitly evaluated. Instead, steric interactions are modeled using a local volume fraction constraint enforced by the field. To avoid frustration during the simulation, we need to slowly “titrate” reader proteins into the system over the course of the Monte Carlo simulation. This is a form of simulated annealing. The schedule for adding reader proteins into the system is specified in the
<code class="docutils literal notranslate"><span class="pre">chromo.util.mu_schedules</span></code> module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Built-in modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getmembers</span><span class="p">,</span> <span class="n">isfunction</span>    <span class="c1"># We need these to select a simulated annealing schedule</span>

<span class="c1"># Third-party modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Custom modules</span>
<span class="kn">from</span> <span class="nn">chromo.binders</span> <span class="kn">import</span> <span class="n">get_by_name</span><span class="p">,</span> <span class="n">make_binder_collection</span>
<span class="kn">from</span> <span class="nn">chromo.polymers</span> <span class="kn">import</span> <span class="n">Chromatin</span>   <span class="c1"># Notice, we replaced the SSWLC with Chromatin</span>
<span class="kn">from</span> <span class="nn">chromo.fields</span> <span class="kn">import</span> <span class="n">UniformDensityField</span>   <span class="c1"># Notice, we replaced the NullField with UniformDensityField</span>
<span class="kn">import</span> <span class="nn">chromo.mc</span> <span class="k">as</span> <span class="nn">mc</span>
<span class="kn">import</span> <span class="nn">chromo.mc.mc_controller</span> <span class="k">as</span> <span class="nn">ctrl</span>
<span class="kn">from</span> <span class="nn">chromo.util.reproducibility</span> <span class="kn">import</span> <span class="n">get_unique_subfolder_name</span>
<span class="kn">import</span> <span class="nn">chromo.util.mu_schedules</span> <span class="k">as</span> <span class="nn">ms</span>    <span class="c1"># Notice, we added the mu_schedules module</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Specify-Binders">
<h2>Specify Binders<a class="headerlink" href="#Specify-Binders" title="Permalink to this heading">¶</a></h2>
<p>Since we are interested in modeling chromatin modified by H3K9me3, we will want to specify HP1 binders to preferentially bind marked sites. We can use the name “HP1” to instantiate the HP1 readers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate the HP1 reader protein</span>
<span class="n">hp1</span> <span class="o">=</span> <span class="n">get_by_name</span><span class="p">(</span><span class="s2">&quot;HP1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can modify the physical properties of HP1 by adjusting the attributes of the HP1 object. See documentation for the <code class="docutils literal notranslate"><span class="pre">ReaderProtein</span></code> class of the <code class="docutils literal notranslate"><span class="pre">binders</span></code> module for descriptions of the physical properties that can be modified. For the purposes of this demonstration, I will set the chemical potential of HP1 to -1.2 kT, which typically results in selective binding of HP1 to marked sites in a one-mark simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hp1</span><span class="o">.</span><span class="n">chemical_potential</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.2</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a binder collection with the HP1 reader protein</span>
<span class="n">binder_collection</span> <span class="o">=</span> <span class="n">make_binder_collection</span><span class="p">(</span><span class="n">hp1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Specify-the-Confinement">
<h2>Specify the Confinement<a class="headerlink" href="#Specify-the-Confinement" title="Permalink to this heading">¶</a></h2>
<p>Again, we will specify a spherical confinement to contain the chromatin fiber. The radius of the confinement will be arbitrarily set to 200 nm for the purposes of this demonstration.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">confine_type</span> <span class="o">=</span> <span class="s2">&quot;Spherical&quot;</span>
<span class="n">confine_radius</span> <span class="o">=</span> <span class="mf">200.0</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Instantiate-Epigenetic-Mark-Pattern">
<h2>Instantiate Epigenetic Mark Pattern<a class="headerlink" href="#Instantiate-Epigenetic-Mark-Pattern" title="Permalink to this heading">¶</a></h2>
<p>The epigenetic mark pattern must be represented by a 2D numpy array where rows correspond to nucleosome positions and columns correspond to different marks. If a mark pattern is stored in a file, it can be loaded using the <code class="docutils literal notranslate"><span class="pre">load_seqs</span></code> static method of the <code class="docutils literal notranslate"><span class="pre">Chromatin</span></code> class. Otherwise, it can be specified manually. In this case, we will specify the mark pattern manually so that the first 500 beads are unmarked, and the last 500 beads are each modified with two H3K9me3 marks (one on each
histone tail). The modification states must be specified as integers.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_beads</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">h3k9me3_pattern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_beads</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">h3k9me3_pattern</span><span class="p">[</span><span class="mi">500</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of mark pattern:&quot;</span><span class="p">,</span> <span class="n">h3k9me3_pattern</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Shape of mark pattern: (1000, 1)
</pre></div></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Specify-Initial-Reader-Protein-Binding-States">
<h2>Specify Initial Reader Protein Binding States<a class="headerlink" href="#Specify-Initial-Reader-Protein-Binding-States" title="Permalink to this heading">¶</a></h2>
<p>Each histone tail on a nucleosome can be modified with an HP1 reader protein. We need to specify the initial HP1 binding state along the chromatin fiber. Specify the initial reader protein binding states using a 2D numpy array where rows correspond to nucleosome positions and columns correspond to different reader proteins. It is common practice to assume no reader proteins are bound and then allow the simulation to reach an equilibrated binding state. In this case, we will specify that no HP1
reader proteins are initially bound to the chromatin fiber. The modification states must be specified as integers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_beads</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Instantiate-the-Polymer">
<h2>Instantiate the Polymer<a class="headerlink" href="#Instantiate-the-Polymer" title="Permalink to this heading">¶</a></h2>
<p>In this case, the polymer will represent a chromatin fiber. We will instantiate the <code class="docutils literal notranslate"><span class="pre">Chromatin</span></code> class instead of the <code class="docutils literal notranslate"><span class="pre">SSWLC</span></code> class. The persistence length of the polymer represented by the <code class="docutils literal notranslate"><span class="pre">Chromatin</span></code> class is automatically set to 53-nm, consistent with the persistence length of bare DNA. We will specify a bead spacing of 16.5-nm, which is representative of the typical linker length between adjacent nucleosomes. Again, we will use the <code class="docutils literal notranslate"><span class="pre">confined_gaussian_walk</span></code> class method to instantiate
the polymer inside a spherical confinement. Notice, when specifying a chromatin fiber, we also specify details about the epigenetic marks and binders (specifically the modification and binding patterns as well as the mark and reader names).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the name, number of beads, and bead spacing of the chromatin fiber</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Chr&quot;</span>
<span class="n">bead_spacing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_beads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">16.5</span>

<span class="c1"># Instantiate the chromatin fiber</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">Chromatin</span><span class="o">.</span><span class="n">confined_gaussian_walk</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">num_beads</span><span class="p">,</span>
    <span class="n">bead_spacing</span><span class="p">,</span>
    <span class="n">confine_type</span><span class="o">=</span><span class="n">confine_type</span><span class="p">,</span>
    <span class="n">confine_length</span><span class="o">=</span><span class="n">confine_radius</span><span class="p">,</span>
    <span class="n">states</span><span class="o">=</span><span class="n">states</span><span class="p">,</span>    <span class="c1"># Specify the initial reader protein binding states</span>
    <span class="n">binder_names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hp1</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span>    <span class="c1"># Specify the name of the reader protein</span>
    <span class="n">chemical_mods</span><span class="o">=</span><span class="n">h3k9me3_pattern</span><span class="p">,</span>    <span class="c1"># Specify the pattern of the epigenetic mark</span>
    <span class="n">chemical_mod_names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;H3K9me3&quot;</span><span class="p">])</span>    <span class="c1"># Specify the name of the epigenetic mark</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Specify-the-Uniform-Density-Field">
<h2>Specify the Uniform Density Field<a class="headerlink" href="#Specify-the-Uniform-Density-Field" title="Permalink to this heading">¶</a></h2>
<p>Unlike a homopolymer, a chromatin fiber involves interacting reader proteins. We do not evaluate reader protein interactions explicitly, as doing so would be too computationally intensive for long fibers. Instead, we model reader protein interactions using a uniform density field, implemented in the <code class="docutils literal notranslate"><span class="pre">UniformDensityField</span></code> class of the <code class="docutils literal notranslate"><span class="pre">fields</span></code> module.</p>
<p>The uniform density field assumes that reader proteins occupying nearby regions of space tend to interact. Below we specify the uniform density field with voxel dimensions consistent with <a class="reference external" href="https://doi.org/10.1073/pnas.1812268115">MacPherson et al. PNAS 2018</a>. We include buffer voxels to ensure that the field extends beyond the confinement. The <code class="docutils literal notranslate"><span class="pre">chi</span></code> parameter is a non-specific interaction parameter that is based on interactions between the chromatin fiber and solvent.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">assume_fully_accessible</span></code> parameter is set to 1 to assume that each voxel is fully accessible by the chromatin fiber. This approximation is not exact for voxels along the confinement boundary, but it is reasonable enough for the purposes of this demonstration and improves computational efficiency. The <code class="docutils literal notranslate"><span class="pre">fast_field</span></code> parameter is set equal to 0, which turns off the “fast-field approximation” that would further speed up field calculations (see the documentation for the
<code class="docutils literal notranslate"><span class="pre">UniformDensityField</span></code> class for more details).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1"># Specify the dimensions of the field</span>
<span class="n">n_accessible</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mi">63</span> <span class="o">*</span> <span class="n">confine_radius</span><span class="p">)</span> <span class="o">/</span> <span class="mi">900</span><span class="p">))</span>
<span class="n">n_buffer</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_bins_x</span> <span class="o">=</span> <span class="n">n_accessible</span> <span class="o">+</span> <span class="n">n_buffer</span>
<span class="n">x_width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">confine_radius</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_buffer</span><span class="o">/</span><span class="n">n_accessible</span><span class="p">)</span>
<span class="n">n_bins_y</span> <span class="o">=</span> <span class="n">n_bins_x</span>
<span class="n">y_width</span> <span class="o">=</span> <span class="n">x_width</span>
<span class="n">n_bins_z</span> <span class="o">=</span> <span class="n">n_bins_x</span>
<span class="n">z_width</span> <span class="o">=</span> <span class="n">x_width</span>

<span class="c1"># Initialize the uniform density field</span>
<span class="n">udf</span> <span class="o">=</span> <span class="n">UniformDensityField</span><span class="p">(</span>
    <span class="p">[</span><span class="n">poly</span><span class="p">],</span>
    <span class="n">binder_collection</span><span class="p">,</span>
    <span class="n">x_width</span><span class="p">,</span>
    <span class="n">n_bins_x</span><span class="p">,</span>
    <span class="n">y_width</span><span class="p">,</span>
    <span class="n">n_bins_y</span><span class="p">,</span>
    <span class="n">z_width</span><span class="p">,</span>
    <span class="n">n_bins_z</span><span class="p">,</span>
    <span class="n">confine_type</span><span class="o">=</span><span class="n">confine_type</span><span class="p">,</span>
    <span class="n">confine_length</span><span class="o">=</span><span class="n">confine_radius</span><span class="p">,</span>
    <span class="n">chi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">assume_fully_accessible</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">fast_field</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Specify-the-Simulation-Parameters">
<h2>Specify the Simulation Parameters<a class="headerlink" href="#Specify-the-Simulation-Parameters" title="Permalink to this heading">¶</a></h2>
<p>The simulation parameters are specified in the same way as in the previous tutorials. There are two differences in the case of a chromatin fiber:</p>
<ol class="arabic simple">
<li><p>We will include a “binding move” which will randomly sample HP1 binding states along the chromatin fiber.</p></li>
<li><p>We will use simulated annealing to slowly ramp up the HP1 chemical potential to -1.2 kT. This avoids frustration in the MC simulation. The simulated annealing schedules are specified in the <code class="docutils literal notranslate"><span class="pre">chromo.util.mu_schedules</span></code> module.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amp_bead_bounds</span><span class="p">,</span> <span class="n">amp_move_bounds</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_amplitude_bounds</span><span class="p">(</span>
    <span class="n">polymers</span> <span class="o">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_snapshots</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">mc_steps_per_snapshot</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a list of simulated annealing schedules, which are defined in another file</span>
<span class="n">schedules</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">isfunction</span><span class="p">)]</span>

<span class="c1"># Select a schedule for slowly adding HP1 into the system</span>
<span class="n">select_schedule</span> <span class="o">=</span> <span class="s2">&quot;linear_step_for_negative_cp&quot;</span>
<span class="n">mu_schedules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">func_name</span><span class="p">))</span> <span class="k">for</span> <span class="n">func_name</span> <span class="ow">in</span> <span class="n">schedules</span>
<span class="p">]</span>
<span class="n">mu_schedules</span> <span class="o">=</span> <span class="p">[</span><span class="n">sch</span> <span class="k">for</span> <span class="n">sch</span> <span class="ow">in</span> <span class="n">mu_schedules</span> <span class="k">if</span> <span class="n">sch</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">select_schedule</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Run-the-Simulation">
<h2>Run the Simulation<a class="headerlink" href="#Run-the-Simulation" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the output directory</span>
<span class="n">out_dir</span> <span class="o">=</span> <span class="s2">&quot;output_demo&quot;</span>

<span class="c1"># Run the simulation</span>
<span class="n">polymers</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">polymer_in_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">poly</span><span class="p">],</span>
    <span class="n">binder_collection</span><span class="p">,</span>
    <span class="n">udf</span><span class="p">,</span>
    <span class="n">mc_steps_per_snapshot</span><span class="p">,</span>
    <span class="n">num_snapshots</span><span class="p">,</span>
    <span class="n">amp_bead_bounds</span><span class="p">,</span>
    <span class="n">amp_move_bounds</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
    <span class="n">mu_schedule</span><span class="o">=</span><span class="n">mu_schedules</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="Plot-the-Resulting-Configuration">
<h2>Plot the Resulting Configuration<a class="headerlink" href="#Plot-the-Resulting-Configuration" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the final configuration of the polymer</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">polymers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">polymers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">polymers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial_3_one_mark_chromatin_25_0.png" src="_images/tutorial_3_one_mark_chromatin_25_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_4_two_mark_chromatin.html" class="btn btn-neutral float-right" title="Tutorial 4: Two-Mark Chromatin" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_2_confined_semiflexible_homopolymer.html" class="btn btn-neutral" title="Tutorial 2: Confined, Semiflexible Homopolymer" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2024, Joseph Wakim, Bruno Beltran, Andrew Spakowitz.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/documentation_options.js"></script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script type="text/javascript" src="None"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>