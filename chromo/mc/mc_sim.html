<!DOCTYPE html>
<!-- Generated by Cython 0.29.32 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: mc_sim.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.32</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="mc_sim.cpp">mc_sim.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># cython: profile=False</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="sd">&quot;&quot;&quot;Routines for performing Monte Carlo simulations.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">006</span>: <span class="k">import</span> <span class="nn">pyximport</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyximport, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_pyximport, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">007</span>: <span class="n">pyximport</span><span class="o">.</span><span class="n">install</span><span class="p">()</span></pre>
<pre class='cython code score-9 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pyximport);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_install);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">008</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c"># Built-in Modules</span></pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">010</span>: <span class="k">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span></pre>
<pre class='cython code score-29 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_List);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_List);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_List);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Optional);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Optional);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_n_s_Optional);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_typing, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_List);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_List, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_Optional);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Optional, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="k">from</span> <span class="nn">libc.stdlib</span> <span class="k">cimport</span> <span class="n">rand</span><span class="p">,</span> <span class="n">RAND_MAX</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c"># External Modules</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">014</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">015</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="c"># Custom Modules</span></pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>: <span class="k">from</span> <span class="nn">chromo.polymers</span> <span class="k">import</span> <span class="n">PolymerBase</span><span class="p">,</span> <span class="n">DetailedChromatinWithSterics</span></pre>
<pre class='cython code score-13 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_PolymerBase);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_PolymerBase);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_PolymerBase);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_DetailedChromatinWithSterics);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_DetailedChromatinWithSterics);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, __pyx_n_s_DetailedChromatinWithSterics);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_polymers, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="k">from</span> <span class="nn">chromo.polymers</span> <span class="k">cimport</span> <span class="n">PolymerBase</span><span class="p">,</span> <span class="n">DetailedChromatinWithSterics</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: <span class="k">from</span> <span class="nn">chromo.mc.moves</span> <span class="k">import</span> <span class="n">MCAdapter</span></pre>
<pre class='cython code score-11 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_MCAdapter);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_MCAdapter);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_MCAdapter);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_mc_moves, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="k">from</span> <span class="nn">chromo.mc.moves</span> <span class="k">cimport</span> <span class="n">MCAdapter</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">021</span>: <span class="k">from</span> <span class="nn">chromo.mc.mc_controller</span> <span class="k">import</span> <span class="n">Controller</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Controller);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Controller);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_Controller);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_mc_mc_controller, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_Controller);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Controller, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="k">from</span> <span class="nn">chromo.fields</span> <span class="k">cimport</span> <span class="n">UniformDensityField</span> <span class="k">as</span> <span class="n">Udf</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">023</span>: <span class="k">from</span> <span class="nn">chromo.fields</span> <span class="k">import</span> <span class="n">FieldBase</span></pre>
<pre class='cython code score-11 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_FieldBase);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_FieldBase);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_FieldBase);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_fields, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">024</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: </pre>
<pre class="cython line score-99" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">026</span>: <span class="k">cpdef</span> <span class="kt">void</span> <span class="nf">mc_sim</span><span class="p">(</span></pre>
<pre class='cython code score-99 '>static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_1mc_sim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_6chromo_2mc_6mc_sim_mc_sim(PyObject *__pyx_v_polymers, PyObject *__pyx_v_readerproteins, long __pyx_v_num_mc_steps, PyObject *__pyx_v_mc_move_controllers, struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field, double __pyx_v_mu_adjust_factor, long __pyx_v_random_seed, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_v_active_field;
  int __pyx_v_update_pairwise_distances;
  long __pyx_v_i;
  CYTHON_UNUSED long __pyx_v_j;
  CYTHON_UNUSED long __pyx_v_k;
  CYTHON_UNUSED long __pyx_v_n_polymers;
  PyObject *__pyx_v_active_fields = 0;
  PyObject *__pyx_v_poly = 0;
  PyObject *__pyx_v_controller = NULL;
  CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_sim", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.mc_sim.mc_sim", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_active_fields);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_poly);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_controller);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v__);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_1mc_sim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_6mc_sim_mc_sim[] = "Perform Monte Carlo simulation.\n\n    Pseudocode\n    ----------\n    Repeat for each Monte Carlo step:\n        Repeat for each adaptable move:\n            If active, apply move to each polymer\n            \n    Notes\n    -----\n    To report process time for each interval of MC steps, add the following:\n    \n    if (k+1) % 50000 == 0:\n        print(\"MC Step \" + str(k+1) + \" of \" + str(num_mc_steps))\n        print(\n            \"Time for previous 50000 MC Steps (in seconds): \", round(\n                process_time()-t1_start, 2\n            )\n        )\n        t1_start = process_time()\n        \n    TODO: To make the simulator more reproducible, consider setting a random\n    seed for the CYTHON code. Note, this uses srand (in libc.stdlib). However,\n    be very careful not to accidentally set the random seed in the wrong place\n    so as not to disrupt the randomness of the simulation. This is a potential\n    source of error.\n\n    Parameters\n    ----------\n    polymers : List[Polymer]\n        Polymers affected by Monte Carlo simulation\n    readerproteins : List[ReaderProteins]\n        Specification of reader proteins on polymer\n    num_mc_steps : int\n        Number of Monte Carlo steps to take between save points\n    mc_move_controllers : List[Controller]\n        List of controllers for active MC moves in simulation\n    field: FieldBase (or subclass)\n        Field affecting polymer in Monte Carlo simulation\n    mu_adjust_factor : double\n        Adjustment factor applied to the chemical potential in response to\n        simulated annealing\n    random_seed : int\n        Randoms seed with which to initialize simulation\n    ";
static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_1mc_sim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_polymers = 0;
  PyObject *__pyx_v_readerproteins = 0;
  long __pyx_v_num_mc_steps;
  PyObject *__pyx_v_mc_move_controllers = 0;
  struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field = 0;
  double __pyx_v_mu_adjust_factor;
  long __pyx_v_random_seed;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_sim (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymers,&amp;__pyx_n_s_readerproteins,&amp;__pyx_n_s_num_mc_steps,&amp;__pyx_n_s_mc_move_controllers,&amp;__pyx_n_s_field,&amp;__pyx_n_s_mu_adjust_factor,&amp;__pyx_n_s_random_seed,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymers)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_readerproteins)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 1); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_mc_steps)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 2); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mc_move_controllers)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 3); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_field)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 4); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mu_adjust_factor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 5); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_random_seed)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, 6); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mc_sim") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 7) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
    }
    __pyx_v_polymers = ((PyObject*)values[0]);
    __pyx_v_readerproteins = values[1];
    __pyx_v_num_mc_steps = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_num_mc_steps == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L3_error)</span>
    __pyx_v_mc_move_controllers = ((PyObject*)values[3]);
    __pyx_v_field = ((struct __pyx_obj_6chromo_6fields_FieldBase *)values[4]);
    __pyx_v_mu_adjust_factor = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_mu_adjust_factor == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L3_error)</span>
    __pyx_v_random_seed = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[6]); if (unlikely((__pyx_v_random_seed == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 29, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_sim", 1, 7, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.mc_sim.mc_sim", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymers), (&amp;PyList_Type), 1, "polymers", 1))) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mc_move_controllers), (&amp;PyList_Type), 1, "mc_move_controllers", 1))) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_field), __pyx_ptype_6chromo_6fields_FieldBase, 1, "field", 0))) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_6mc_sim_mc_sim(__pyx_self, __pyx_v_polymers, __pyx_v_readerproteins, __pyx_v_num_mc_steps, __pyx_v_mc_move_controllers, __pyx_v_field, __pyx_v_mu_adjust_factor, __pyx_v_random_seed);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_6mc_sim_mc_sim(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_polymers, PyObject *__pyx_v_readerproteins, long __pyx_v_num_mc_steps, PyObject *__pyx_v_mc_move_controllers, struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field, double __pyx_v_mu_adjust_factor, long __pyx_v_random_seed) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_sim", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6chromo_2mc_6mc_sim_mc_sim(__pyx_v_polymers, __pyx_v_readerproteins, __pyx_v_num_mc_steps, __pyx_v_mc_move_controllers, __pyx_v_field, __pyx_v_mu_adjust_factor, __pyx_v_random_seed, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.mc_sim.mc_sim", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">027</span>:     <span class="nb">list</span> <span class="n">polymers</span><span class="p">,</span> <span class="n">readerproteins</span><span class="p">,</span> <span class="nb">long</span> <span class="n">num_mc_steps</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>:     <span class="nb">list</span> <span class="n">mc_move_controllers</span><span class="p">,</span> <span class="n">FieldBase</span> <span class="n">field</span><span class="p">,</span> <span class="n">double</span> <span class="n">mu_adjust_factor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>:     <span class="nb">long</span> <span class="n">random_seed</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Monte Carlo simulation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: <span class="sd">    Pseudocode</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: <span class="sd">    Repeat for each Monte Carlo step:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="sd">        Repeat for each adaptable move:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="sd">            If active, apply move to each polymer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="sd">            </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="sd">    To report process time for each interval of MC steps, add the following:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">    if (k+1) % 50000 == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">        print(&quot;MC Step &quot; + str(k+1) + &quot; of &quot; + str(num_mc_steps))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="sd">        print(</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="sd">            &quot;Time for previous 50000 MC Steps (in seconds): &quot;, round(</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: <span class="sd">                process_time()-t1_start, 2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: <span class="sd">            )</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: <span class="sd">        )</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: <span class="sd">        t1_start = process_time()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: <span class="sd">        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: <span class="sd">    TODO: To make the simulator more reproducible, consider setting a random</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: <span class="sd">    seed for the CYTHON code. Note, this uses srand (in libc.stdlib). However,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">    be very careful not to accidentally set the random seed in the wrong place</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">    so as not to disrupt the randomness of the simulation. This is a potential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: <span class="sd">    source of error.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: <span class="sd">    polymers : List[Polymer]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: <span class="sd">        Polymers affected by Monte Carlo simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: <span class="sd">    readerproteins : List[ReaderProteins]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: <span class="sd">        Specification of reader proteins on polymer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>: <span class="sd">    num_mc_steps : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: <span class="sd">        Number of Monte Carlo steps to take between save points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>: <span class="sd">    mc_move_controllers : List[Controller]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: <span class="sd">        List of controllers for active MC moves in simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: <span class="sd">    field: FieldBase (or subclass)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: <span class="sd">        Field affecting polymer in Monte Carlo simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: <span class="sd">    mu_adjust_factor : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: <span class="sd">        Adjustment factor applied to the chemical potential in response to</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="sd">        simulated annealing</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: <span class="sd">    random_seed : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: <span class="sd">        Randoms seed with which to initialize simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">active_field</span><span class="p">,</span> <span class="nf">update_pairwise_distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span><span class="p">,</span> <span class="nf">n_polymers</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:     <span class="k">cdef</span> <span class="kt">list</span> <span class="nf">active_fields</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     <span class="k">cdef</span> <span class="nf">poly</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>: </pre>
<pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">081</span>:     <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span></pre>
<pre class='cython code score-26 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_random_seed);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 81, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:     <span class="n">n_polymers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymers</span><span class="p">)</span></pre>
<pre class='cython code score-6 '>  if (unlikely(__pyx_v_polymers == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
    <span class='error_goto'>__PYX_ERR(0, 82, __pyx_L1_error)</span>
  }
  __pyx_t_5 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_polymers);<span class='error_goto'> if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)</span>
  __pyx_v_n_polymers = __pyx_t_5;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:     <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confine_type</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_v_field-&gt;confine_type, __pyx_kp_s_, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
  __pyx_t_7 = (__pyx_t_6 != 0);
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:         <span class="n">active_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">is_field_active</span><span class="p">()</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polymers</span><span class="p">]</span></pre>
<pre class='cython code score-38 '>    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (unlikely(__pyx_v_polymers == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
      <span class='error_goto'>__PYX_ERR(0, 84, __pyx_L1_error)</span>
    }
    __pyx_t_2 = __pyx_v_polymers; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_5 = 0;
    for (;;) {
      if (__pyx_t_5 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 84, __pyx_L1_error)</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_poly, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_poly, __pyx_n_s_is_field_active);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
        }
      }
      __pyx_t_3 = (__pyx_t_8) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 84, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_1, (PyObject*)__pyx_t_3))) <span class='error_goto'>__PYX_ERR(0, 84, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_active_fields = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">085</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>:         <span class="n">active_fields</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">polymers</span><span class="p">]</span></pre>
<pre class='cython code score-19 '>  /*else*/ {
    __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (unlikely(__pyx_v_polymers == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
      <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    }
    __pyx_t_2 = __pyx_v_polymers; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_5 = 0;
    for (;;) {
      if (__pyx_t_5 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_5++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v__, __pyx_t_3);
      __pyx_t_3 = 0;
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_1, (PyObject*)__pyx_int_1))) <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_active_fields = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">087</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_mc_steps</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = __pyx_v_num_mc_steps;
  __pyx_t_10 = __pyx_t_9;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_k = __pyx_t_11;
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:         <span class="k">for</span> <span class="n">controller</span> <span class="ow">in</span> <span class="n">mc_move_controllers</span><span class="p">:</span></pre>
<pre class='cython code score-12 '>    if (unlikely(__pyx_v_mc_move_controllers == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
      <span class='error_goto'>__PYX_ERR(0, 89, __pyx_L1_error)</span>
    }
    __pyx_t_1 = __pyx_v_mc_move_controllers; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_5 = 0;
    for (;;) {
      if (__pyx_t_5 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_5); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_5++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 89, __pyx_L1_error)</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_5); __pyx_t_5++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_controller, __pyx_t_2);
      __pyx_t_2 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:             <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">move</span><span class="o">.</span><span class="n">move_on</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-11 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_controller, __pyx_n_s_move);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_move_on);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 90, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_EqObjC</span>(__pyx_t_3, __pyx_int_1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 90, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_7) {
/* … */
      }
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:                 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">move</span><span class="o">.</span><span class="n">num_per_cycle</span><span class="p">):</span></pre>
<pre class='cython code score-13 '>        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_controller, __pyx_n_s_move);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 91, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_num_per_cycle);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 91, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_12 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 91, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_13 = __pyx_t_12;
        for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
          __pyx_v_j = __pyx_t_14;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polymers</span><span class="p">)):</span></pre>
<pre class='cython code score-6 '>          if (unlikely(__pyx_v_polymers == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
            <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
          }
          __pyx_t_15 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_polymers);<span class='error_goto'> if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 92, __pyx_L1_error)</span>
          __pyx_t_16 = __pyx_t_15;
          for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
            __pyx_v_i = __pyx_t_17;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:                         <span class="n">poly</span> <span class="o">=</span> <span class="n">polymers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>            if (unlikely(__pyx_v_polymers == Py_None)) {
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
              <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
            }
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt_List</span>(__pyx_v_polymers, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 1, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_poly, __pyx_t_3);
            __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">094</span>:                         <span class="c"># Update distances depending on the class of the polymer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:                         <span class="n">update_pairwise_distances</span> <span class="o">=</span> <span class="w">\</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:                             <span class="nb">isinstance</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">DetailedChromatinWithSterics</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_TypeCheck</span>(__pyx_v_poly, __pyx_ptype_6chromo_8polymers_DetailedChromatinWithSterics); 
            __pyx_v_update_pairwise_distances = __pyx_t_7;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:                         <span class="n">poly</span><span class="o">.</span><span class="n">mu_adjust_factor</span> <span class="o">=</span> <span class="n">mu_adjust_factor</span></pre>
<pre class='cython code score-8 '>            __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_mu_adjust_factor);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_v_poly, __pyx_n_s_mu_adjust_factor, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:                         <span class="n">active_field</span> <span class="o">=</span> <span class="n">active_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-10 '>            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt_List</span>(__pyx_v_active_fields, __pyx_v_i, long, 1, __Pyx_PyInt_From_long, 1, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_v_active_field = __pyx_t_7;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:                         <span class="n">mc_step</span><span class="p">(</span></pre>
<pre class='cython code score-1 '>            __pyx_f_6chromo_2mc_6mc_sim_mc_step(((struct __pyx_obj_6chromo_2mc_5moves_MCAdapter *)__pyx_t_3), ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)__pyx_v_poly), __pyx_v_readerproteins, __pyx_v_field, __pyx_v_active_field, __pyx_v_update_pairwise_distances, 0);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          }
        }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:                             <span class="n">controller</span><span class="o">.</span><span class="n">move</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">readerproteins</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span></pre>
<pre class='cython code score-6 '>            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_controller, __pyx_n_s_move);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_6chromo_2mc_5moves_MCAdapter))))) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
            if (!(likely(((__pyx_v_poly) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_poly, __pyx_ptype_6chromo_8polymers_PolymerBase))))) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>:                             <span class="n">active_field</span><span class="p">,</span> <span class="n">update_pairwise_distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:                         <span class="p">)</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:             <span class="n">controller</span><span class="o">.</span><span class="n">update_amplitudes</span><span class="p">()</span></pre>
<pre class='cython code score-19 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_controller, __pyx_n_s_update_amplitudes);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 103, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
        }
      }
      __pyx_t_3 = (__pyx_t_4) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">104</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>: </pre>
<pre class="cython line score-78" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">106</span>: <span class="k">cpdef</span> <span class="kt">void</span> <span class="nf">mc_step</span><span class="p">(</span></pre>
<pre class='cython code score-78 '>static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_3mc_step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_6chromo_2mc_6mc_sim_mc_step(struct __pyx_obj_6chromo_2mc_5moves_MCAdapter *__pyx_v_adaptible_move, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_poly, CYTHON_UNUSED PyObject *__pyx_v_readerproteins, struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field, int __pyx_v_active_field, int __pyx_v_update_distances, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_dE;
  double __pyx_v_exp_dE;
  int __pyx_v_check_field;
  long __pyx_v_packet_size;
  long __pyx_v_n_inds;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_step", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.mc_sim.mc_step", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_3mc_step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_6mc_sim_2mc_step[] = "Compute energy change and determine move acceptance.\n\n    Notes\n    -----\n    Get the proposed state of the polymer. Calculate the total (polymer +\n    field) energy change associated with the move. Accept or reject the move\n    based on the Metropolis Criterion.\n\n    After evaluating change in energy (from the polymer and the field), the\n    try-except statement checks for RuntimeWarning if the change in energy gets\n    too large.\n\n    Parameters\n    ----------\n    adaptible_move: MCAdapter\n        Move applied at particular Monte Carlo step\n    poly: PolymerBase\n        Polymer affected by move at particular Monte Carlo step\n    readerproteins: List[ReaderProteins]\n        Reader proteins affecting polymer configuration\n    field: FieldBase (or subclass)\n        Field affecting polymer in Monte Carlo step\n    active_field: bool\n        Indicator of whether or not the field is active for the polymer\n    update_distances : bint\n        Update pairwise distances between beads -- only relevant if the\n        polymer is an instance of DetailedChromatinWithSterics, which\n        tracks pairwise distances between beads\n    ";
static PyObject *__pyx_pw_6chromo_2mc_6mc_sim_3mc_step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_2mc_5moves_MCAdapter *__pyx_v_adaptible_move = 0;
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_poly = 0;
  PyObject *__pyx_v_readerproteins = 0;
  struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field = 0;
  int __pyx_v_active_field;
  int __pyx_v_update_distances;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_step (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_adaptible_move,&amp;__pyx_n_s_poly,&amp;__pyx_n_s_readerproteins,&amp;__pyx_n_s_field,&amp;__pyx_n_s_active_field,&amp;__pyx_n_s_update_distances,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_adaptible_move)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_poly)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_readerproteins)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_field)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_active_field)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_update_distances)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mc_step") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_adaptible_move = ((struct __pyx_obj_6chromo_2mc_5moves_MCAdapter *)values[0]);
    __pyx_v_poly = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[1]);
    __pyx_v_readerproteins = values[2];
    __pyx_v_field = ((struct __pyx_obj_6chromo_6fields_FieldBase *)values[3]);
    __pyx_v_active_field = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[4]); if (unlikely((__pyx_v_active_field == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L3_error)</span>
    __pyx_v_update_distances = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[5]); if (unlikely((__pyx_v_update_distances == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mc_step", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 106, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.mc_sim.mc_step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_adaptible_move), __pyx_ptype_6chromo_2mc_5moves_MCAdapter, 1, "adaptible_move", 0))) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_poly), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "poly", 0))) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_field), __pyx_ptype_6chromo_6fields_FieldBase, 1, "field", 0))) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_6mc_sim_2mc_step(__pyx_self, __pyx_v_adaptible_move, __pyx_v_poly, __pyx_v_readerproteins, __pyx_v_field, __pyx_v_active_field, __pyx_v_update_distances);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_6mc_sim_2mc_step(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_2mc_5moves_MCAdapter *__pyx_v_adaptible_move, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_poly, PyObject *__pyx_v_readerproteins, struct __pyx_obj_6chromo_6fields_FieldBase *__pyx_v_field, int __pyx_v_active_field, int __pyx_v_update_distances) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mc_step", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6chromo_2mc_6mc_sim_mc_step(__pyx_v_adaptible_move, __pyx_v_poly, __pyx_v_readerproteins, __pyx_v_field, __pyx_v_active_field, __pyx_v_update_distances, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.mc_sim.mc_step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">107</span>:     <span class="n">MCAdapter</span> <span class="n">adaptible_move</span><span class="p">,</span> <span class="n">PolymerBase</span> <span class="n">poly</span><span class="p">,</span> <span class="n">readerproteins</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>:     <span class="n">FieldBase</span> <span class="n">field</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">active_field</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">update_distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute energy change and determine move acceptance.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: <span class="sd">    Get the proposed state of the polymer. Calculate the total (polymer +</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: <span class="sd">    field) energy change associated with the move. Accept or reject the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: <span class="sd">    based on the Metropolis Criterion.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: <span class="sd">    After evaluating change in energy (from the polymer and the field), the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: <span class="sd">    try-except statement checks for RuntimeWarning if the change in energy gets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: <span class="sd">    too large.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: <span class="sd">    adaptible_move: MCAdapter</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: <span class="sd">        Move applied at particular Monte Carlo step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: <span class="sd">    poly: PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: <span class="sd">        Polymer affected by move at particular Monte Carlo step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: <span class="sd">    readerproteins: List[ReaderProteins]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: <span class="sd">        Reader proteins affecting polymer configuration</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: <span class="sd">    field: FieldBase (or subclass)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: <span class="sd">        Field affecting polymer in Monte Carlo step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: <span class="sd">    active_field: bool</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: <span class="sd">        Indicator of whether or not the field is active for the polymer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>: <span class="sd">    update_distances : bint</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: <span class="sd">        Update pairwise distances between beads -- only relevant if the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: <span class="sd">        polymer is an instance of DetailedChromatinWithSterics, which</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: <span class="sd">        tracks pairwise distances between beads</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dE</span><span class="p">,</span> <span class="nf">exp_dE</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">check_field</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_check_field = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">packet_size</span><span class="p">,</span> <span class="nf">n_inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:     <span class="k">if</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">field</span> <span class="ow">and</span> <span class="n">active_field</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PySequence_ContainsTF</span>(((PyObject *)__pyx_v_poly), ((PyObject *)__pyx_v_field), Py_EQ)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__pyx_v_active_field != 0);
  __pyx_t_1 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:         <span class="k">if</span> <span class="n">adaptible_move</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;tangent_rotation&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_v_adaptible_move-&gt;name, __pyx_n_s_tangent_rotation, Py_NE)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
    __pyx_t_3 = (__pyx_t_1 != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">146</span>:             <span class="n">check_field</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_check_field = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">147</span>:     <span class="n">packet_size</span> <span class="o">=</span> <span class="mf">20</span></pre>
<pre class='cython code score-0 '>  __pyx_v_packet_size = 20;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">148</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">adaptible_move</span><span class="o">.</span><span class="n">propose</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((struct __pyx_vtabstruct_6chromo_2mc_5moves_MCAdapter *)__pyx_v_adaptible_move-&gt;__pyx_vtab)-&gt;propose(__pyx_v_adaptible_move, __pyx_v_poly);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  __pyx_v_inds = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_inds); 
  __pyx_v_n_inds = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:     <span class="k">if</span> <span class="n">n_inds</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_n_inds == 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:         <span class="k">return</span></pre>
<pre class='cython code score-0 '>    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:     <span class="n">dE</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dE = 0.0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:     <span class="n">dE</span> <span class="o">+=</span> <span class="n">poly</span><span class="o">.</span><span class="n">compute_dE</span><span class="p">(</span><span class="n">adaptible_move</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_6 = __pyx_v_adaptible_move-&gt;name;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
  __pyx_v_dE = (__pyx_v_dE + ((struct __pyx_vtabstruct_6chromo_8polymers_PolymerBase *)__pyx_v_poly-&gt;__pyx_vtab)-&gt;compute_dE(__pyx_v_poly, ((PyObject*)__pyx_t_6), __pyx_v_inds, __pyx_v_n_inds));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:     <span class="k">if</span> <span class="n">check_field</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_check_field == 1) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:         <span class="k">if</span> <span class="n">adaptible_move</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;change_binding_state&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_v_adaptible_move-&gt;name, __pyx_n_s_change_binding_state, Py_EQ)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
    __pyx_t_1 = (__pyx_t_3 != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L9;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:             <span class="n">dE</span> <span class="o">+=</span> <span class="n">field</span><span class="o">.</span><span class="n">compute_dE</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dE = (__pyx_v_dE + ((struct __pyx_vtabstruct_6chromo_6fields_FieldBase *)__pyx_v_field-&gt;__pyx_vtab)-&gt;compute_dE(__pyx_v_field, __pyx_v_poly, __pyx_v_inds, __pyx_v_n_inds, __pyx_v_packet_size, 1));
</pre><pre class="cython line score-0">&#xA0;<span class="">157</span>:                 <span class="n">poly</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">packet_size</span><span class="p">,</span> <span class="n">state_change</span><span class="o">=</span><span class="mf">1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:             <span class="n">dE</span> <span class="o">+=</span> <span class="n">field</span><span class="o">.</span><span class="n">compute_dE</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
/* … */
      __pyx_v_dE = (__pyx_v_dE + ((struct __pyx_vtabstruct_6chromo_6fields_FieldBase *)__pyx_v_field-&gt;__pyx_vtab)-&gt;compute_dE(__pyx_v_field, __pyx_v_poly, __pyx_v_inds, __pyx_v_n_inds, __pyx_v_packet_size, 0));
    }
    __pyx_L9:;
</pre><pre class="cython line score-0">&#xA0;<span class="">161</span>:                 <span class="n">poly</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">packet_size</span><span class="p">,</span> <span class="n">state_change</span><span class="o">=</span><span class="mf">0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>:             <span class="p">)</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:     <span class="k">try</span><span class="p">:</span></pre>
<pre class='cython code score-11 '>  {
    /*try:*/ {
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    goto __pyx_L15_try_end;
    __pyx_L10_error:;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
/* … */
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_7);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_8);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_9);
    <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
    goto __pyx_L1_error;
    __pyx_L11_exception_handled:;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_7);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_8);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_9);
    <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
    __pyx_L15_try_end:;
  }
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:         <span class="n">exp_dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dE</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 164, __pyx_L10_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 164, __pyx_L10_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_dE));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 164, __pyx_L10_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_12 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
        __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
        if (likely(__pyx_t_12)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
        }
      }
      __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_12, __pyx_t_10) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 164, __pyx_L10_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 164, __pyx_L10_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_v_exp_dE = __pyx_t_13;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:     <span class="k">except</span> <span class="ne">RuntimeWarning</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyErr_ExceptionMatches</span>(__pyx_builtin_RuntimeWarning);
    if (__pyx_t_14) {
      <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.mc_sim.mc_step", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (<span class='pyx_c_api'>__Pyx_GetException</span>(&amp;__pyx_t_6, &amp;__pyx_t_11, &amp;__pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 165, __pyx_L12_except_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:         <span class="k">if</span> <span class="n">dE</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_1 = ((__pyx_v_dE &gt; 0.0) != 0);
      if (__pyx_t_1) {
/* … */
        goto __pyx_L18;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:             <span class="n">exp_dE</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_exp_dE = 0.0;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:         <span class="k">elif</span> <span class="n">dE</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-3 '>      __pyx_t_1 = ((__pyx_v_dE &lt; 0.0) != 0);
      if (__pyx_t_1) {
/* … */
      }
      __pyx_L18:;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L11_exception_handled;
    }
    goto __pyx_L12_except_error;
    __pyx_L12_except_error:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:             <span class="n">exp_dE</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_v_exp_dE = 1.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:     <span class="k">if</span> <span class="p">(&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">exp_dE</span><span class="p">:</span></pre>
<pre class='cython code score-5 '>  __pyx_t_13 = ((double)rand());
  if (unlikely(RAND_MAX == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
  }
  __pyx_t_1 = (((__pyx_t_13 / RAND_MAX) &lt; __pyx_v_exp_dE) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L19;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:         <span class="n">adaptible_move</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_6chromo_2mc_5moves_MCAdapter *)__pyx_v_adaptible_move-&gt;__pyx_vtab)-&gt;accept(__pyx_v_adaptible_move, __pyx_v_poly, __pyx_v_dE, __pyx_v_inds, __pyx_v_n_inds, 0, 0, __pyx_v_update_distances, 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">173</span>:             <span class="n">poly</span><span class="p">,</span> <span class="n">dE</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">log_move</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">log_update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:             <span class="n">update_distances</span><span class="o">=</span><span class="n">update_distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>:         <span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:         <span class="k">if</span> <span class="n">check_field</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_check_field == 1) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:             <span class="n">field</span><span class="o">.</span><span class="n">update_affected_densities</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_6chromo_6fields_FieldBase *)__pyx_v_field-&gt;__pyx_vtab)-&gt;update_affected_densities(__pyx_v_field);
</pre><pre class="cython line score-0">&#xA0;<span class="">178</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>:         <span class="n">adaptible_move</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
/* … */
    ((struct __pyx_vtabstruct_6chromo_2mc_5moves_MCAdapter *)__pyx_v_adaptible_move-&gt;__pyx_vtab)-&gt;reject(__pyx_v_adaptible_move, __pyx_v_poly, __pyx_v_dE, __pyx_v_inds, __pyx_v_n_inds, 0, 0, __pyx_v_update_distances, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 179, __pyx_L1_error)</span>
  }
  __pyx_L19:;
</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>:             <span class="n">poly</span><span class="p">,</span> <span class="n">dE</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">log_move</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">log_update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:             <span class="n">update_distances</span><span class="o">=</span><span class="n">update_distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:         <span class="p">)</span></pre>
</div></body></html>
