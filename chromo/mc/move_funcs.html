<!DOCTYPE html>
<!-- Generated by Cython 0.29.32 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: move_funcs.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.32</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="move_funcs.cpp">move_funcs.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># cython: profile=True</span></pre>
<pre class='cython code score-8 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="sd">&quot;&quot;&quot;Functions for performing Monte Carlo transformations.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="sd">Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="sd">-----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="sd">TODO: No need to make a numpy inds array when the inds are continuous!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">010</span>: <span class="k">import</span> <span class="nn">pyximport</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyximport, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_pyximport, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">011</span>: <span class="n">pyximport</span><span class="o">.</span><span class="n">install</span><span class="p">()</span></pre>
<pre class='cython code score-9 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pyximport);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_install);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">012</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c"># Built-in Modules</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="k">from</span> <span class="nn">libc.stdlib</span> <span class="k">cimport</span> <span class="n">rand</span><span class="p">,</span> <span class="n">RAND_MAX</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">sqrt</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">016</span>: <span class="k">import</span> <span class="nn">sys</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_sys, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sys, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="c"># External Modules</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="k">ctypedef</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8_t</span> <span class="n">uint8</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: <span class="c"># Custom Modules</span></pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">024</span>: <span class="k">import</span> <span class="nn">chromo.util.bead_selection</span> <span class="k">as</span> <span class="nn">beads</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__25);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s__25);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_util_bead_selection, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_beads, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="k">cimport</span> <span class="nn">chromo.util.bead_selection</span> <span class="k">as</span> <span class="nn">beads</span></pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">026</span>: <span class="k">import</span> <span class="nn">chromo.util.linalg</span> <span class="k">as</span> <span class="nn">la</span></pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__25);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s__25);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_util_linalg, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_la, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="k">cimport</span> <span class="nn">chromo.util.linalg</span> <span class="k">as</span> <span class="nn">la</span></pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">028</span>: <span class="k">import</span> <span class="nn">chromo.polymers</span> <span class="k">as</span> <span class="nn">poly</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__25);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s__25);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_polymers, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_poly, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="k">cimport</span> <span class="nn">chromo.polymers</span> <span class="k">as</span> <span class="nn">poly</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">030</span>: <span class="k">from</span> <span class="nn">chromo.binders</span> <span class="k">import</span> <span class="n">Binder</span></pre>
<pre class='cython code score-11 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Binder);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Binder);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_Binder);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_chromo_binders, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="k">from</span> <span class="nn">chromo.binders</span> <span class="k">cimport</span> <span class="n">Binder</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">034</span>: <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span></pre>
<pre class='cython code score-23 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_float_0_);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_float_0_);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 2, __pyx_float_0_);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_6chromo_2mc_10move_funcs_origin, 1);
  __pyx_v_6chromo_2mc_10move_funcs_origin = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="c"># Crank Shaft Move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">039</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">crank_shaft</span><span class="p">(</span></pre>
<pre class='cython code score-66 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_1crank_shaft(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_crank_shaft(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_ang;
  long __pyx_v_bound_0;
  long __pyx_v_bound_1;
  long __pyx_v_ind0;
  long __pyx_v_indf;
  long __pyx_v_n_inds;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("crank_shaft", 0);
  <span class='trace'>__Pyx_TraceCall</span>("crank_shaft", __pyx_f[0], 39, 0, <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.crank_shaft", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_1crank_shaft(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_crank_shaft[] = "Rotate section of polymer around axis connecting two end beads.\n    \n    Notes\n    -----\n    The crank shaft move affects a continuous range of beads; the internal\n    configuration is unaffected by the crank shaft move. Therefore, when\n    evaluating polymer energy change associated with the move, it is sufficient\n    to look only at the ends of the affected segment.\n\n    Begin by randomly selecting a starting and ending index for the crank-shaft\n    move based on the bead amplitude. Then generate a random rotation angle for\n    the move based on the move amplitude. Obtain the axis of rotation from the\n    change in position between the starting and ending beads. Finally, generate\n    the rotation matrix and obtain trial positions and tangents for evaluation.\n    \n    TODO: If greater speed boost is needed, return the length of `inds`.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object\n    amp_move : double\n        Maximum amplitude (rotation angle) of the crank-shaft move\n    amp_bead : int\n        Maximum amplitude (number) of beads affected by the crank-shaft move\n\n    Returns\n    -------\n    array_like (M,) of long\n        Indices of M beads affected by the MC move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_1crank_shaft(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("crank_shaft (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("crank_shaft", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("crank_shaft", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "crank_shaft") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 40, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 40, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("crank_shaft", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.crank_shaft", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 40, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_crank_shaft(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_crank_shaft(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("crank_shaft", 0);
  <span class='trace'>__Pyx_TraceCall</span>("crank_shaft (wrapper)", __pyx_f[0], 39, 0, <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_crank_shaft(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 39, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 39, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.crank_shaft", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">040</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate section of polymer around axis connecting two end beads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="sd">    The crank shaft move affects a continuous range of beads; the internal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: <span class="sd">    configuration is unaffected by the crank shaft move. Therefore, when</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: <span class="sd">    evaluating polymer energy change associated with the move, it is sufficient</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: <span class="sd">    to look only at the ends of the affected segment.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: <span class="sd">    Begin by randomly selecting a starting and ending index for the crank-shaft</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: <span class="sd">    move based on the bead amplitude. Then generate a random rotation angle for</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: <span class="sd">    the move based on the move amplitude. Obtain the axis of rotation from the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">    change in position between the starting and ending beads. Finally, generate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">    the rotation matrix and obtain trial positions and tangents for evaluation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: <span class="sd">    TODO: If greater speed boost is needed, return the length of `inds`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>: <span class="sd">        Maximum amplitude (rotation angle) of the crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: <span class="sd">    amp_bead : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>: <span class="sd">        Maximum amplitude (number) of beads affected by the crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: <span class="sd">        Indices of M beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     <span class="c"># print(&quot;Crank-shaft Move&quot;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ang</span><span class="p">,</span> <span class="nf">ele_r</span><span class="p">,</span> <span class="nf">ele_t3</span><span class="p">,</span> <span class="nf">ele_t2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">bound_0</span><span class="p">,</span> <span class="nf">bound_1</span><span class="p">,</span> <span class="nf">ind0</span><span class="p">,</span> <span class="nf">indf</span><span class="p">,</span> <span class="nf">n_inds</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     <span class="c"># Stochastic move selection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:     <span class="n">ang</span> <span class="o">=</span> <span class="n">pick_random_amp</span><span class="p">(</span><span class="n">amp_move</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ang = __pyx_f_6chromo_2mc_10move_funcs_pick_random_amp(__pyx_v_amp_move);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">081</span>:     <span class="n">bound_0</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;((&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">*</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = ((double)rand());
  if (unlikely(RAND_MAX == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 81, __pyx_L1_error)</span>
  }
  __pyx_v_bound_0 = ((int)((__pyx_t_1 / RAND_MAX) * __pyx_v_polymer-&gt;num_beads));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:     <span class="n">bound_1</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">from_point</span><span class="p">(</span><span class="n">amp_bead</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">,</span> <span class="n">bound_0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_bound_1 = __pyx_f_6chromo_4util_14bead_selection_from_point(__pyx_v_amp_bead, __pyx_v_polymer-&gt;num_beads, __pyx_v_bound_0, 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:     <span class="n">bound_1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bound_1</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 1;
  __pyx_t_3 = __pyx_v_bound_1;
  if (((__pyx_t_2 &gt; __pyx_t_3) != 0)) {
    __pyx_t_4 = __pyx_t_2;
  } else {
    __pyx_t_4 = __pyx_t_3;
  }
  __pyx_v_bound_1 = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:     <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">check_bead_bounds</span><span class="p">(</span><span class="n">bound_0</span><span class="p">,</span> <span class="n">bound_1</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_f_6chromo_4util_14bead_selection_check_bead_bounds(__pyx_v_bound_0, __pyx_v_bound_1, __pyx_v_polymer-&gt;num_beads);
  __pyx_t_4 = __pyx_t_5.f0;
  __pyx_t_2 = __pyx_t_5.f1;
  __pyx_v_ind0 = __pyx_t_4;
  __pyx_v_indf = __pyx_t_2;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_indf);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = NULL;
  __pyx_t_11 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      __pyx_t_11 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  {
    __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    if (__pyx_t_10) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_11, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_11, __pyx_t_9);
    __pyx_t_7 = 0;
    __pyx_t_9 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_6, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_inds = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="n">ind0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_inds = (__pyx_v_indf - __pyx_v_ind0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">ang</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_ang;
</pre><pre class="cython line score-0">&#xA0;<span class="">089</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:     <span class="c"># Prep for Deterministic Transformation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:     <span class="n">get_crank_shaft_axis</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_get_crank_shaft_axis(__pyx_v_polymer, __pyx_v_ind0, __pyx_v_indf);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:     <span class="n">get_crank_shaft_fulcrum</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_get_crank_shaft_fulcrum(__pyx_v_polymer, __pyx_v_ind0, __pyx_v_indf);
</pre><pre class="cython line score-0">&#xA0;<span class="">093</span>:     <span class="c"># noinspection PyTypeChecker</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:     <span class="n">la</span><span class="o">.</span><span class="n">arbitrary_axis_rotation</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_4util_6linalg_arbitrary_axis_rotation(__pyx_v_polymer-&gt;direction, __pyx_v_polymer-&gt;point, __pyx_v_ang, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:         <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">polymer</span></pre>
<pre class='cython code score-10 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 95, __pyx_L1_error)</span>}
  if (unlikely(!__pyx_v_polymer-&gt;point.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 95, __pyx_L1_error)</span>}
</pre><pre class="cython line score-0">&#xA0;<span class="">096</span>:     <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>:     <span class="c"># &quot;Efficient&quot; matrix multiplication</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:     <span class="n">transform_r_t3_t2</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_transform_r_t3_t2(__pyx_v_polymer, __pyx_v_inds, __pyx_v_n_inds, 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">102</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pick_random_amp</span><span class="p">(</span><span class="n">double</span> <span class="n">amp_move</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static double __pyx_f_6chromo_2mc_10move_funcs_pick_random_amp(double __pyx_v_amp_move) {
  double __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pick_random_amp", 0);
  <span class='trace'>__Pyx_TraceCall</span>("pick_random_amp", __pyx_f[0], 104, 0, <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.pick_random_amp", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Select a random positive or negative amplitude for an MC move.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: <span class="sd">        Range of maximum amplitude for the move; in practice, the amplitude </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: <span class="sd">        of the move is selected from between +/- amp_move/2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: <span class="sd">    double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: <span class="sd">        Random amplitude selected for the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>:     <span class="k">return</span> <span class="n">amp_move</span> <span class="o">*</span> <span class="p">((&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = ((double)rand());
  if (unlikely(RAND_MAX == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 118, __pyx_L1_error)</span>
  }
  __pyx_r = (__pyx_v_amp_move * ((__pyx_t_1 / RAND_MAX) - 0.5));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">119</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: </pre>
<pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>: <span class="k">cpdef</span> <span class="kt">void</span> <span class="nf">transform_r_t3_t2</span><span class="p">(</span></pre>
<pre class='cython code score-49 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_3transform_r_t3_t2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_6chromo_2mc_10move_funcs_transform_r_t3_t2(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, __Pyx_memviewslice __pyx_v_inds, long __pyx_v_n_inds, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_ele_r;
  double __pyx_v_ele_t3;
  double __pyx_v_ele_t2;
  long __pyx_v_i;
  long __pyx_v_j;
  long __pyx_v_k;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("transform_r_t3_t2", 0);
  <span class='trace'>__Pyx_TraceCall</span>("transform_r_t3_t2", __pyx_f[0], 121, 0, <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.transform_r_t3_t2", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_3transform_r_t3_t2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_2transform_r_t3_t2[] = "Apply transformation operations to `r_trial`, `t3_trial`, `t2_trial`.\n    \n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer affected by the transformation (which is also storing the\n        transformation matrix).\n    inds : long[:]\n        Bead indices affected by the MC move\n    n_inds : long\n        Number of indices affected by the move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_3transform_r_t3_t2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_n_inds;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("transform_r_t3_t2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_inds,&amp;__pyx_n_s_n_inds,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_inds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("transform_r_t3_t2", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_inds)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("transform_r_t3_t2", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transform_r_t3_t2") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_inds = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_inds.memview)) __PYX_ERR(0, 123, __pyx_L3_error)</span>
    __pyx_v_n_inds = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_n_inds == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 124, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("transform_r_t3_t2", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.transform_r_t3_t2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 122, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_2transform_r_t3_t2(__pyx_self, __pyx_v_polymer, __pyx_v_inds, __pyx_v_n_inds);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_2transform_r_t3_t2(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, __Pyx_memviewslice __pyx_v_inds, long __pyx_v_n_inds) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("transform_r_t3_t2", 0);
  <span class='trace'>__Pyx_TraceCall</span>("transform_r_t3_t2 (wrapper)", __pyx_f[0], 121, 0, <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_inds.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("inds"); <span class='error_goto'>__PYX_ERR(0, 121, __pyx_L1_error)</span> }
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6chromo_2mc_10move_funcs_transform_r_t3_t2(__pyx_v_polymer, __pyx_v_inds, __pyx_v_n_inds, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.transform_r_t3_t2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">122</span>:         <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         <span class="nb">long</span><span class="p">[:]</span> <span class="n">inds</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:         <span class="nb">long</span> <span class="n">n_inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply transformation operations to `r_trial`, `t3_trial`, `t2_trial`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: <span class="sd">        Polymer affected by the transformation (which is also storing the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: <span class="sd">        transformation matrix).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: <span class="sd">    inds : long[:]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>: <span class="sd">        Bead indices affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: <span class="sd">    n_inds : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: <span class="sd">        Number of indices affected by the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ele_r</span><span class="p">,</span> <span class="nf">ele_t3</span><span class="p">,</span> <span class="nf">ele_t2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n_inds;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_4 = 0; __pyx_t_4 &lt; 3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:             <span class="n">ele_r</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_r = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">142</span>:             <span class="n">ele_t3</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t3 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">143</span>:             <span class="n">ele_t2</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      for (__pyx_t_5 = 0; __pyx_t_5 &lt; 3; __pyx_t_5+=1) {
        __pyx_v_k = __pyx_t_5;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:                 <span class="n">ele_r</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span><span class="w">\</span></pre>
<pre class='cython code score-7 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>}
        __pyx_t_6 = __pyx_v_j;
        __pyx_t_7 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_6 &lt; 0) {
          __pyx_t_6 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
        }
/* â€¦ */
        __pyx_v_ele_r = (__pyx_v_ele_r + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_6 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_7)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_10 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_11)) )))));
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">146</span>:                     <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>        if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_i;
        __pyx_t_8 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>
        }
        __pyx_t_10 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_9 * __pyx_v_inds.strides[0]) )));
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_v_polymer-&gt;r.shape[0];
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_polymer-&gt;r.shape[1];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>
        }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">147</span>:                 <span class="n">ele_t3</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span><span class="w">\</span></pre>
<pre class='cython code score-7 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 147, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_j;
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 147, __pyx_L1_error)</span>
        }
/* â€¦ */
        __pyx_v_ele_t3 = (__pyx_v_ele_t3 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_9 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_11)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3.data + __pyx_t_7 * __pyx_v_polymer-&gt;t3.strides[0]) )) + __pyx_t_6)) )))));
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">148</span>:                     <span class="n">polymer</span><span class="o">.</span><span class="n">t3</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>        if (unlikely(!__pyx_v_polymer-&gt;t3.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>}
        __pyx_t_10 = __pyx_v_i;
        __pyx_t_8 = -1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
        }
        __pyx_t_7 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_10 * __pyx_v_inds.strides[0]) )));
        __pyx_t_6 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;t3.shape[0];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t3.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_6 &lt; 0) {
          __pyx_t_6 += __pyx_v_polymer-&gt;t3.shape[1];
          if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;t3.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
        }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:                 <span class="n">ele_t2</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span><span class="w">\</span></pre>
<pre class='cython code score-7 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>}
        __pyx_t_10 = __pyx_v_j;
        __pyx_t_6 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_6 &lt; 0) {
          __pyx_t_6 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
        }
/* â€¦ */
        __pyx_v_ele_t2 = (__pyx_v_ele_t2 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_10 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_6)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2.data + __pyx_t_11 * __pyx_v_polymer-&gt;t2.strides[0]) )) + __pyx_t_9)) )))));
      }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:                     <span class="n">polymer</span><span class="o">.</span><span class="n">t2</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>        if (unlikely(!__pyx_v_polymer-&gt;t2.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>}
        __pyx_t_7 = __pyx_v_i;
        __pyx_t_8 = -1;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>
        }
        __pyx_t_11 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_7 * __pyx_v_inds.strides[0]) )));
        __pyx_t_9 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_polymer-&gt;t2.shape[0];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;t2.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;t2.shape[1];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;t2.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>
        }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">r_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span><span class="w">\</span></pre>
<pre class='cython code score-9 '>      if (unlikely(!__pyx_v_polymer-&gt;r_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>}
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_8 = -1;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
      }
      __pyx_t_6 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_11 * __pyx_v_inds.strides[0]) )));
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_8 = -1;
      if (__pyx_t_6 &lt; 0) {
        __pyx_t_6 += __pyx_v_polymer-&gt;r_trial.shape[0];
        if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;r_trial.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_polymer-&gt;r_trial.shape[1];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_polymer-&gt;r_trial.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r_trial.data + __pyx_t_6 * __pyx_v_polymer-&gt;r_trial.strides[0]) )) + __pyx_t_10)) )) = (__pyx_v_ele_r + (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_7 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_9)) ))));
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:                 <span class="n">ele_r</span> <span class="o">+</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-7 '>      if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 152, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_9 = 3;
      __pyx_t_8 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 152, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t3_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t3</span></pre>
<pre class='cython code score-9 '>      if (unlikely(!__pyx_v_polymer-&gt;t3_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 153, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_8 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 153, __pyx_L1_error)</span>
      }
      __pyx_t_7 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_9 * __pyx_v_inds.strides[0]) )));
      __pyx_t_11 = __pyx_v_j;
      __pyx_t_8 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;t3_trial.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_v_polymer-&gt;t3_trial.shape[1];
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 153, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3_trial.data + __pyx_t_7 * __pyx_v_polymer-&gt;t3_trial.strides[0]) )) + __pyx_t_11)) )) = __pyx_v_ele_t3;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t2_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t2</span></pre>
<pre class='cython code score-9 '>      if (unlikely(!__pyx_v_polymer-&gt;t2_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_8 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>
      }
      __pyx_t_11 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_9 * __pyx_v_inds.strides[0]) )));
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_8 = -1;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_v_polymer-&gt;t2_trial.shape[0];
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;t2_trial.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2_trial.data + __pyx_t_11 * __pyx_v_polymer-&gt;t2_trial.strides[0]) )) + __pyx_t_7)) )) = __pyx_v_ele_t2;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">get_crank_shaft_axis</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_6chromo_2mc_10move_funcs_get_crank_shaft_axis(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, long __pyx_v_ind0, long __pyx_v_indf) {
  long __pyx_v_i;
  long __pyx_v_indf_m1;
  long __pyx_v_ind0_m1;
  long __pyx_v_n_beads_m1;
  CYTHON_UNUSED long __pyx_v_ind0_p2;
  CYTHON_UNUSED long __pyx_v_ind0_m2;
  double __pyx_v_scaling;
  double __pyx_v_magnitude;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_crank_shaft_axis", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get_crank_shaft_axis", __pyx_f[0], 157, 0, <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.get_crank_shaft_axis", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">158</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="nb">long</span> <span class="n">ind0</span><span class="p">,</span> <span class="nb">long</span> <span class="n">indf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the axis of rotation for the crank shaft move from bead selection.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>: <span class="sd">    For-loops are less elegant, but quicker than element-wise numpy operations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>: <span class="sd">    once compiled. Our goal is to avoid python objects as much as possible. To</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: <span class="sd">    do so, we are using memoryviews, which do not support element-wise </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>: <span class="sd">    operations.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>: <span class="sd">    The following cases affect the axis of rotation for the crank-shaft move:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>: <span class="sd">        - CASE 1: Only first bead selected -&gt; axis defined by first two beads</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>: <span class="sd">        - CASE 2: Only last bead selected -&gt; axis defined by last two beads</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>: <span class="sd">        - CASE 3: Full chain selected -&gt; axis defined by first and last beads</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>: <span class="sd">        - CASE 4: First bead selected -&gt; axis defined by first bead and first </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: <span class="sd">            non-selected neighboring bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>: <span class="sd">        - CASE 5: Last bead selected -&gt; axis defined by last non-selected </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>: <span class="sd">            neighboring bead and last bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>: <span class="sd">        - CASE 6: Internal beads selected -&gt; axis defined by last non-selected</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>: <span class="sd">            neighboring bead on left &amp; first non-selected neighboring bead on</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: <span class="sd">            right</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: <span class="sd">        Polymer object for which crank-shaft move is applied</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: <span class="sd">    ind0 : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: <span class="sd">        Starting bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>: <span class="sd">    indf : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>: <span class="sd">        One past ending bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">indf_m1</span><span class="p">,</span> <span class="nf">ind0_m1</span><span class="p">,</span> <span class="nf">n_beads_m1</span><span class="p">,</span> <span class="nf">ind0_p2</span><span class="p">,</span> <span class="nf">ind0_m2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">scaling</span><span class="p">,</span> <span class="nf">magnitude</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:     <span class="n">indf_m1</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_indf_m1 = (__pyx_v_indf - 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:     <span class="n">ind0_m1</span> <span class="o">=</span> <span class="n">ind0</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ind0_m1 = (__pyx_v_ind0 - 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:     <span class="n">ind0_m2</span> <span class="o">=</span> <span class="n">ind0</span> <span class="o">-</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ind0_m2 = (__pyx_v_ind0 - 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:     <span class="n">ind0_p2</span> <span class="o">=</span> <span class="n">ind0</span> <span class="o">+</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ind0_p2 = (__pyx_v_ind0 + 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:     <span class="n">n_beads_m1</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_beads_m1 = (__pyx_v_polymer-&gt;num_beads - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>:     <span class="c"># CASE 1: Only first bead selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:     <span class="k">if</span> <span class="n">ind0</span> <span class="o">==</span> <span class="n">indf_m1</span> <span class="ow">and</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == __pyx_v_indf_m1) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>}
      __pyx_t_4 = __pyx_v_indf;
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_ind0;
      __pyx_t_8 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_4 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_5)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_7 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_8)) ))));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">204</span>:     <span class="c"># CASE 2: Only last bead selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:     <span class="k">elif</span> <span class="n">ind0</span> <span class="o">==</span> <span class="n">indf_m1</span> <span class="ow">and</span> <span class="n">ind0</span> <span class="o">==</span> <span class="n">n_beads_m1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == __pyx_v_indf_m1) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_ind0 == __pyx_v_n_beads_m1) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>}
      __pyx_t_8 = __pyx_v_ind0;
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_ind0_m1;
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_8 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_7)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_5 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_4)) ))));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>:     <span class="c"># CASE 3: Full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:     <span class="k">elif</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf_m1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>}
      __pyx_t_4 = __pyx_v_indf_m1;
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_ind0;
      __pyx_t_8 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_4 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_5)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_7 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_8)) ))));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">212</span>:     <span class="c"># CASE 4: First bead selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:     <span class="k">elif</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>}
      __pyx_t_8 = __pyx_v_indf;
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_ind0;
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_8 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_7)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_5 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_4)) ))));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">216</span>:     <span class="c"># CASE 5: Last bead selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:     <span class="k">elif</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf_m1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>}
      __pyx_t_4 = __pyx_v_indf_m1;
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_ind0_m1;
      __pyx_t_8 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_4 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_5)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_7 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_8)) ))));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">220</span>:     <span class="c"># CASE 6: Internal beads selected</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>}
      __pyx_t_8 = __pyx_v_indf;
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_ind0_m1;
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_9 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_8 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_7)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_5 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_4)) ))));
    }
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:     <span class="n">magnitude</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_v_magnitude = sqrt(((pow((*((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_4 * __pyx_v_polymer-&gt;direction.strides[0]) ))), 2.0) + pow((*((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_5 * __pyx_v_polymer-&gt;direction.strides[0]) ))), 2.0)) + pow((*((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_7 * __pyx_v_polymer-&gt;direction.strides[0]) ))), 2.0)));
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:         <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span></pre>
<pre class='cython code score-14 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>}
  __pyx_t_4 = 0;
  __pyx_t_6 = -1;
  if (__pyx_t_4 &lt; 0) {
    __pyx_t_4 += __pyx_v_polymer-&gt;direction.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
  } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
  if (unlikely(__pyx_t_6 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
    <span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>
  }
  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>}
  __pyx_t_5 = 1;
  __pyx_t_6 = -1;
  if (__pyx_t_5 &lt; 0) {
    __pyx_t_5 += __pyx_v_polymer-&gt;direction.shape[0];
    if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
  } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
  if (unlikely(__pyx_t_6 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
    <span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">227</span>:         <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-7 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 227, __pyx_L1_error)</span>}
  __pyx_t_7 = 2;
  __pyx_t_6 = -1;
  if (__pyx_t_7 &lt; 0) {
    __pyx_t_7 += __pyx_v_polymer-&gt;direction.shape[0];
    if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
  } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
  if (unlikely(__pyx_t_6 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
    <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">228</span>:     <span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">229</span>:     <span class="k">if</span> <span class="n">magnitude</span> <span class="o">&lt;</span> <span class="mf">1E-5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_magnitude &lt; 1E-5) != 0);
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L22;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:         <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere();<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 230, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_polymer-&gt;direction, 0);
    __pyx_v_polymer-&gt;direction = __pyx_t_10;
    __pyx_t_10.memview = NULL;
    __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">231</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:         <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">magnitude</span></pre>
<pre class='cython code score-5 '>  /*else*/ {
    if (unlikely(__pyx_v_magnitude == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 232, __pyx_L1_error)</span>
    }
    __pyx_v_scaling = (1.0 / __pyx_v_magnitude);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaling</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;direction.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;direction.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_5 * __pyx_v_polymer-&gt;direction.strides[0]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;direction.data + __pyx_t_7 * __pyx_v_polymer-&gt;direction.strides[0]) ))) * __pyx_v_scaling);
    }
  }
  __pyx_L22:;
</pre><pre class="cython line score-0">&#xA0;<span class="">235</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">get_crank_shaft_fulcrum</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_6chromo_2mc_10move_funcs_get_crank_shaft_fulcrum(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, long __pyx_v_ind0, long __pyx_v_indf) {
  long __pyx_v_ind0_m1;
  long __pyx_v_i;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_crank_shaft_fulcrum", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get_crank_shaft_fulcrum", __pyx_f[0], 237, 0, <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.get_crank_shaft_fulcrum", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">238</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="nb">long</span> <span class="n">ind0</span><span class="p">,</span> <span class="nb">long</span> <span class="n">indf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the folcrum about which to rotate beads for the crank shaft move.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>: <span class="sd">    Selection of the fulcrum for the crank shaft move is affected by which </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>: <span class="sd">    beads are selected for the move. Consider the following cases:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>: <span class="sd">        - CASE 1: `ind0` is 0 and full chain not selected -&gt; folcrum is `indf`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>: <span class="sd">        - CASE 2: `indf` is `polymer.num_beads` and full chain not selected -&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>: <span class="sd">            folcrum is `ind0` - 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: <span class="sd">        - CASE 3: `ind0` is 0 and `indf` is `polymer.num_beads` -&gt; fulcrum is </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: <span class="sd">            `ind0`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: <span class="sd">        - CASE 4: Internal beads selected -&gt; fulcrum is `ind0` - 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: <span class="sd">        Polymer object affected by the crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>: <span class="sd">    ind0 : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>: <span class="sd">        Starting bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>: <span class="sd">    indf : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>: <span class="sd">        One past ending bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">ind0_m1</span> <span class="o">=</span> <span class="n">ind0</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ind0_m1 = (__pyx_v_ind0 - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:     <span class="c"># CASE 1: First bead and not full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:     <span class="k">if</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">!=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf != __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>}
      __pyx_t_4 = __pyx_v_indf;
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;point.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;point.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;point.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;point.data + __pyx_t_7 * __pyx_v_polymer-&gt;point.strides[0]) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_4 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_5)) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">269</span>:     <span class="c"># CASE 2: Last bead and not full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:     <span class="k">elif</span> <span class="n">ind0</span> <span class="o">!=</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 != 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_ind0_m1;
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;point.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;point.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;point.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;point.data + __pyx_t_7 * __pyx_v_polymer-&gt;point.strides[0]) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_5 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_4)) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">273</span>:     <span class="c"># CASE 3: Full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">274</span>:     <span class="k">elif</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">275</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">276</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 276, __pyx_L1_error)</span>}
      __pyx_t_4 = __pyx_v_ind0;
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 276, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;point.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 276, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;point.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;point.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 276, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;point.data + __pyx_t_7 * __pyx_v_polymer-&gt;point.strides[0]) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_4 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_5)) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">277</span>:     <span class="c"># CASE 4: Internal beads selected</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    for (__pyx_t_3 = 0; __pyx_t_3 &lt; 3; __pyx_t_3+=1) {
      __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>}
      __pyx_t_5 = __pyx_v_ind0_m1;
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_6 = 0;
      if (__pyx_t_4 &lt; 0) {
        __pyx_t_4 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_6 = 1;
      } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_6 = 1;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;point.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_6 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;point.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;point.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;point.data + __pyx_t_7 * __pyx_v_polymer-&gt;point.strides[0]) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_5 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_4)) )));
    }
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">281</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: <span class="c"># End Pivot Move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: </pre>
<pre class="cython line score-67" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">end_pivot</span><span class="p">(</span></pre>
<pre class='cython code score-67 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_5end_pivot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_end_pivot(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_ang;
  long __pyx_v_ind0;
  long __pyx_v_indf;
  long __pyx_v_n_inds;
  long __pyx_v_rotate_lhs;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_axis = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_fulcrum = NULL;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("end_pivot", 0);
  <span class='trace'>__Pyx_TraceCall</span>("end_pivot", __pyx_f[0], 285, 0, <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.end_pivot", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_axis, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_fulcrum);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_5end_pivot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_4end_pivot[] = "Randomly rotate segment from end of polymer about random axis.\n\n    Notes\n    -----\n    Begin by selecting a random rotation angle based on the move amplitude. \n    The isolate a random subset of beads on either the LHS or RHS of the \n    polymer; the size of this subset is affected by the bead amplitude. \n    Update the transformation matrix to reflect the end-pivot of this polymer\n    segment about a random rotation axis. Apply the transformation matrix to \n    the polymer position and orientations to generate trial positions and \n    orientations dictated by the move.\n    \n    TODO: Remove the modulo operation when determining whether or not to \n    rotate the LHS of the polymer. Set `rotate_lhs = rand()`. Change the \n    `rotate_lhs` condition to `if rotate_lhs &lt; RAND_MAX/2`.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object\n    amp_move : double\n        Maximum amplitude (rotation angle) of the end-pivot move\n    amp_bead : int\n        Maximum amplitude (number) of beads affected by the end-pivot move\n\n    Returns\n    -------\n    array_like (M,) of long\n        Indices of M beads affected by the MC move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_5end_pivot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("end_pivot (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("end_pivot", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("end_pivot", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "end_pivot") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 286, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 286, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("end_pivot", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.end_pivot", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 286, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_4end_pivot(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_4end_pivot(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("end_pivot", 0);
  <span class='trace'>__Pyx_TraceCall</span>("end_pivot (wrapper)", __pyx_f[0], 285, 0, <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_end_pivot(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.end_pivot", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">286</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly rotate segment from end of polymer about random axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>: <span class="sd">    Begin by selecting a random rotation angle based on the move amplitude. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>: <span class="sd">    The isolate a random subset of beads on either the LHS or RHS of the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: <span class="sd">    polymer; the size of this subset is affected by the bead amplitude. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>: <span class="sd">    Update the transformation matrix to reflect the end-pivot of this polymer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: <span class="sd">    segment about a random rotation axis. Apply the transformation matrix to </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: <span class="sd">    the polymer position and orientations to generate trial positions and </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>: <span class="sd">    orientations dictated by the move.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>: <span class="sd">    TODO: Remove the modulo operation when determining whether or not to </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>: <span class="sd">    rotate the LHS of the polymer. Set `rotate_lhs = rand()`. Change the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>: <span class="sd">    `rotate_lhs` condition to `if rotate_lhs &lt; RAND_MAX/2`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">305</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">307</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">308</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>: <span class="sd">        Maximum amplitude (rotation angle) of the end-pivot move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">310</span>: <span class="sd">    amp_bead : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">311</span>: <span class="sd">        Maximum amplitude (number) of beads affected by the end-pivot move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>: <span class="sd">        Indices of M beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">318</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">319</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ang</span><span class="p">,</span> <span class="nf">ele_r</span><span class="p">,</span> <span class="nf">ele_t3</span><span class="p">,</span> <span class="nf">ele_t2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">ind0</span><span class="p">,</span> <span class="nf">indf</span><span class="p">,</span> <span class="nf">n_inds</span><span class="p">,</span> <span class="nf">rotate_lhs</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">321</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">322</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">axis</span><span class="p">,</span> <span class="n">folcrum</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:     <span class="n">ang</span> <span class="o">=</span> <span class="n">pick_random_amp</span><span class="p">(</span><span class="n">amp_move</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ang = __pyx_f_6chromo_2mc_10move_funcs_pick_random_amp(__pyx_v_amp_move);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>:     <span class="n">rotate_lhs</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>  __pyx_v_rotate_lhs = __Pyx_mod_long(rand(), 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:     <span class="k">if</span> <span class="n">rotate_lhs</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_rotate_lhs == 1) != 0);
  if (__pyx_t_1) {
/* â€¦ */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">328</span>:         <span class="n">ind0</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_ind0 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">329</span>:         <span class="n">indf</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">from_left</span><span class="p">(</span><span class="n">amp_bead</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_indf = (__pyx_f_6chromo_4util_14bead_selection_from_left(__pyx_v_amp_bead, __pyx_v_polymer-&gt;num_beads, 0) + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">330</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:         <span class="n">ind0</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">from_right</span><span class="p">(</span><span class="n">amp_bead</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_ind0 = __pyx_f_6chromo_4util_14bead_selection_from_right(__pyx_v_amp_bead, __pyx_v_polymer-&gt;num_beads, 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">332</span>:         <span class="n">indf</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2 = __pyx_v_polymer-&gt;num_beads;
    __pyx_v_indf = __pyx_t_2;
  }
  __pyx_L3:;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">333</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_indf);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_6};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_6};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_7) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_8, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_8, __pyx_t_6);
    __pyx_t_4 = 0;
    __pyx_t_6 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_inds = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="n">ind0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_inds = (__pyx_v_indf - __pyx_v_ind0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">335</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_t_11 = __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere();<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  __pyx_v_axis = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">336</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">ang</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_ang;
</pre><pre class="cython line score-0">&#xA0;<span class="">338</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>:     <span class="c"># Prep for Deterministic Transformation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">340</span>:     <span class="n">fulcrum</span> <span class="o">=</span> <span class="n">get_end_pivot_fulcrum</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">,</span> <span class="n">rotate_lhs</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_11 = __pyx_f_6chromo_2mc_10move_funcs_get_end_pivot_fulcrum(__pyx_v_polymer, __pyx_v_ind0, __pyx_v_indf, __pyx_v_rotate_lhs);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_11, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
  __pyx_v_fulcrum = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:     <span class="n">la</span><span class="o">.</span><span class="n">arbitrary_axis_rotation</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fulcrum</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">polymer</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_fulcrum, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 341, __pyx_L1_error)</span>
  __pyx_f_6chromo_4util_6linalg_arbitrary_axis_rotation(__pyx_v_axis, __pyx_t_11, __pyx_v_ang, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>:     <span class="c"># &quot;Efficient&quot; matrix multiplication</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>:     <span class="n">transform_r_t3_t2</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_transform_r_t3_t2(__pyx_v_polymer, __pyx_v_inds, __pyx_v_n_inds, 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">345</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">347</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">349</span>: <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">get_end_pivot_fulcrum</span><span class="p">(</span></pre>
<pre class='cython code score-7 '>static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_get_end_pivot_fulcrum(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, long __pyx_v_ind0, long __pyx_v_indf, long __pyx_v_rotate_lhs) {
  long __pyx_v_ind0_m1;
  long __pyx_v_indf_m1;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_end_pivot_fulcrum", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get_end_pivot_fulcrum", __pyx_f[0], 349, 0, <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.get_end_pivot_fulcrum", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">350</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="nb">long</span> <span class="n">ind0</span><span class="p">,</span> <span class="nb">long</span> <span class="n">indf</span><span class="p">,</span> <span class="nb">long</span> <span class="n">rotate_lhs</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">351</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the folcrum about which to pivot end of polymer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>: <span class="sd">    The following four cases affect the selection of the fulcrum for the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: <span class="sd">    end-pivot move:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">358</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>: <span class="sd">        - CASE 1: `ind0` is 0 and full chain not selected -&gt; folcrum is `indf`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">360</span>: <span class="sd">        - CASE 2: `indf` is `polymer.num_beads` and full chain not selected -&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">361</span>: <span class="sd">            folcrum is `ind0` - 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>: <span class="sd">        - CASE 3: `ind0` is 0 and `indf` is `polymer.num_beads`, rotate LHS -&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">363</span>: <span class="sd">            fulcrum is `indf` - 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>: <span class="sd">        - CASE 4: `ind0` is 0 and `indf` is `polymer.num_beads`, rotate RHS -&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>: <span class="sd">            fulcrum is `ind0`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>: <span class="sd">    ind0 : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>: <span class="sd">        Starting bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>: <span class="sd">    indf : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">374</span>: <span class="sd">        One past ending bead index for crank-shaft move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">375</span>: <span class="sd">    rotate_lhs : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">376</span>: <span class="sd">        Indicate for whether to rotate LHS (1) or RHS (0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">377</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">378</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">379</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">380</span>: <span class="sd">    array_like (3,) of double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">381</span>: <span class="sd">        Normalized vector giving orientation of rotation axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">382</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">383</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">ind0_m1</span><span class="p">,</span> <span class="nf">indf_m1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>:     <span class="n">ind0_m1</span> <span class="o">=</span> <span class="n">ind0</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ind0_m1 = (__pyx_v_ind0 - 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">386</span>:     <span class="n">indf_m1</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_indf_m1 = (__pyx_v_indf - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">387</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>:     <span class="c"># CASE 1: First bead and not full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>:     <span class="k">if</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">!=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf != __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">390</span>:         <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></pre>
<pre class='cython code score-10 '>    if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 390, __pyx_L1_error)</span>}
    __pyx_t_3.data = __pyx_v_polymer-&gt;r.data;
    __pyx_t_3.memview = __pyx_v_polymer-&gt;r.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_3, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_indf;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_polymer-&gt;r.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_polymer-&gt;r.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError,
                            "Index out of bounds (axis 0)");
            <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L1_error)</span>
        }
        __pyx_t_3.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_3.shape[0] = __pyx_v_polymer-&gt;r.shape[1];
__pyx_t_3.strides[0] = __pyx_v_polymer-&gt;r.strides[1];
    __pyx_t_3.suboffsets[0] = -1;

__pyx_t_4 = __pyx_memoryview_copy_slice_dc_double_c(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
    __pyx_t_3.memview = NULL;
    __pyx_t_3.data = NULL;
    __pyx_r = __pyx_t_4;
    __pyx_t_4.memview = NULL;
    __pyx_t_4.data = NULL;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">391</span>:     <span class="c"># CASE 2: Last bead and not full chain selected</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">392</span>:     <span class="k">if</span> <span class="n">ind0</span> <span class="o">!=</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 != 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L7_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:         <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0_m1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></pre>
<pre class='cython code score-10 '>    if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 393, __pyx_L1_error)</span>}
    __pyx_t_4.data = __pyx_v_polymer-&gt;r.data;
    __pyx_t_4.memview = __pyx_v_polymer-&gt;r.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_4, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_ind0_m1;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_polymer-&gt;r.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_polymer-&gt;r.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError,
                            "Index out of bounds (axis 0)");
            <span class='error_goto'>__PYX_ERR(0, 393, __pyx_L1_error)</span>
        }
        __pyx_t_4.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_4.shape[0] = __pyx_v_polymer-&gt;r.shape[1];
__pyx_t_4.strides[0] = __pyx_v_polymer-&gt;r.strides[1];
    __pyx_t_4.suboffsets[0] = -1;

__pyx_t_3 = __pyx_memoryview_copy_slice_dc_double_c(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 393, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
    __pyx_t_4.memview = NULL;
    __pyx_t_4.data = NULL;
    __pyx_r = __pyx_t_3;
    __pyx_t_3.memview = NULL;
    __pyx_t_3.data = NULL;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">394</span>:     <span class="c"># CASE 3: Full chain selected, rotate LHS</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>:     <span class="k">if</span> <span class="n">ind0</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">indf</span> <span class="o">==</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span> <span class="ow">and</span> <span class="n">rotate_lhs</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_ind0 == 0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L10_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_indf == __pyx_v_polymer-&gt;num_beads) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L10_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_rotate_lhs == 1) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L10_bool_binop_done:;
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:         <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">indf_m1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></pre>
<pre class='cython code score-10 '>    if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>}
    __pyx_t_3.data = __pyx_v_polymer-&gt;r.data;
    __pyx_t_3.memview = __pyx_v_polymer-&gt;r.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_3, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_indf_m1;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_polymer-&gt;r.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_polymer-&gt;r.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError,
                            "Index out of bounds (axis 0)");
            <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
        }
        __pyx_t_3.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_3.shape[0] = __pyx_v_polymer-&gt;r.shape[1];
__pyx_t_3.strides[0] = __pyx_v_polymer-&gt;r.strides[1];
    __pyx_t_3.suboffsets[0] = -1;

__pyx_t_4 = __pyx_memoryview_copy_slice_dc_double_c(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
    __pyx_t_3.memview = NULL;
    __pyx_t_3.data = NULL;
    __pyx_r = __pyx_t_4;
    __pyx_t_4.memview = NULL;
    __pyx_t_4.data = NULL;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>:     <span class="c"># CASE 4: Full chain selected, rotate RHS</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:     <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">ind0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></pre>
<pre class='cython code score-10 '>  if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>}
  __pyx_t_4.data = __pyx_v_polymer-&gt;r.data;
  __pyx_t_4.memview = __pyx_v_polymer-&gt;r.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_4, 0);
  {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_ind0;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_polymer-&gt;r.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_polymer-&gt;r.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError,
                            "Index out of bounds (axis 0)");
            <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
        }
        __pyx_t_4.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_4.shape[0] = __pyx_v_polymer-&gt;r.shape[1];
__pyx_t_4.strides[0] = __pyx_v_polymer-&gt;r.strides[1];
    __pyx_t_4.suboffsets[0] = -1;

__pyx_t_3 = __pyx_memoryview_copy_slice_dc_double_c(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
  __pyx_r = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">399</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: <span class="c"># Slide Move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>: </pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">slide</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span><span class="p">):</span></pre>
<pre class='cython code score-66 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_7slide(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_slide(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_amp;
  long __pyx_v_bound_0;
  long __pyx_v_bound_1;
  long __pyx_v_ind0;
  long __pyx_v_indf;
  long __pyx_v_n_inds;
  long __pyx_v_i;
  long __pyx_v_j;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("slide", 0);
  <span class='trace'>__Pyx_TraceCall</span>("slide", __pyx_f[0], 403, 0, <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.slide", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_7slide(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_6slide[] = "Randomly translate a segment of the polymer.\n    \n    Notes\n    -----\n    Randomly set the translation distance based on the slide move amplitude.\n    Then randomly pick a direction by sampling uniformally from a unit sphere.\n    Split the translation distance into x, y, z components using the direction.\n    Select a random segment of beads to move based on the bead amplititude,\n    and identify the affected indices. Update and apply the transformation \n    matrix for the translation to the affected beads.\n\n    There is a difference in how we define the move amplitude between this\n    code and the original FORTRAN codebase. In the original codebase, the move\n    amplitude specifies the maximum translation in each dimension, while in this\n    code, the move amplitude specifies the maximum magnitude of translation.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object\n    amp_move : double\n        Maximum amplitude (translation distance) of the slide move\n    amp_bead : int\n        Maximum amplitude (number) of beads affected by the slide move\n\n    Returns\n    -------\n    array_like (M,) of long\n        Indices of M beads affected by the MC move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_7slide(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("slide (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("slide", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("slide", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "slide") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("slide", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.slide", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_6slide(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_6slide(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("slide", 0);
  <span class='trace'>__Pyx_TraceCall</span>("slide (wrapper)", __pyx_f[0], 403, 0, <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_slide(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.slide", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">404</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly translate a segment of the polymer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">407</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">408</span>: <span class="sd">    Randomly set the translation distance based on the slide move amplitude.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: <span class="sd">    Then randomly pick a direction by sampling uniformally from a unit sphere.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: <span class="sd">    Split the translation distance into x, y, z components using the direction.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: <span class="sd">    Select a random segment of beads to move based on the bead amplititude,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: <span class="sd">    and identify the affected indices. Update and apply the transformation </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>: <span class="sd">    matrix for the translation to the affected beads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: <span class="sd">    There is a difference in how we define the move amplitude between this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: <span class="sd">    code and the original FORTRAN codebase. In the original codebase, the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: <span class="sd">    amplitude specifies the maximum translation in each dimension, while in this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>: <span class="sd">    code, the move amplitude specifies the maximum magnitude of translation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">419</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">420</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">423</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">424</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">425</span>: <span class="sd">        Maximum amplitude (translation distance) of the slide move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">426</span>: <span class="sd">    amp_bead : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">427</span>: <span class="sd">        Maximum amplitude (number) of beads affected by the slide move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">428</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">430</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">431</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">432</span>: <span class="sd">        Indices of M beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">433</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">434</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">435</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">amp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">436</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">bound_0</span><span class="p">,</span> <span class="nf">bound_1</span><span class="p">,</span> <span class="nf">ind0</span><span class="p">,</span> <span class="nf">indf</span><span class="p">,</span> <span class="nf">n_inds</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">437</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">438</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">direction</span><span class="p">,</span> <span class="n">delta</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">440</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>:     <span class="n">amp</span> <span class="o">=</span> <span class="n">amp_move</span> <span class="o">*</span> <span class="p">(&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">RAND_MAX</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = ((double)rand());
  if (unlikely(RAND_MAX == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
  }
  __pyx_v_amp = (__pyx_v_amp_move * (__pyx_t_1 / RAND_MAX));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>:     <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere_inplace</span><span class="p">(</span><span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>}
  __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere_inplace(__pyx_v_polymer-&gt;direction);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">443</span>:     <span class="n">la</span><span class="o">.</span><span class="n">inplace_scale3</span><span class="p">(</span><span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">amp</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 443, __pyx_L1_error)</span>}
  __pyx_f_6chromo_4util_6linalg_inplace_scale3(__pyx_v_polymer-&gt;direction, __pyx_v_amp);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">444</span>:     <span class="n">la</span><span class="o">.</span><span class="n">generate_translation_mat</span><span class="p">(</span><span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">polymer</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>}
  __pyx_f_6chromo_4util_6linalg_generate_translation_mat(__pyx_v_polymer-&gt;direction, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>:     <span class="n">bound_0</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-5 '>  __pyx_t_2 = rand();
  if (unlikely(__pyx_v_polymer-&gt;num_beads == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>
  }
  __pyx_v_bound_0 = __Pyx_mod_long(__pyx_t_2, __pyx_v_polymer-&gt;num_beads);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:     <span class="n">bound_1</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">from_point</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_v_bound_1 = __pyx_f_6chromo_4util_14bead_selection_from_point(__pyx_v_amp_bead, __pyx_v_polymer-&gt;num_beads, __pyx_v_bound_0, 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">447</span>:         <span class="n">amp_bead</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">,</span> <span class="n">bound_0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>:     <span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">449</span>:     <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">check_bead_bounds</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_f_6chromo_4util_14bead_selection_check_bead_bounds(__pyx_v_bound_0, __pyx_v_bound_1, __pyx_v_polymer-&gt;num_beads);
  __pyx_t_4 = __pyx_t_3.f0;
  __pyx_t_5 = __pyx_t_3.f1;
  __pyx_v_ind0 = __pyx_t_4;
  __pyx_v_indf = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">450</span>:         <span class="n">bound_0</span><span class="p">,</span> <span class="n">bound_1</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">451</span>:     <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">452</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_indf);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = NULL;
  __pyx_t_2 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      __pyx_t_2 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_2, 2+__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_2, 2+__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  {
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (__pyx_t_10) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0+__pyx_t_2, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1+__pyx_t_2, __pyx_t_9);
    __pyx_t_7 = 0;
    __pyx_t_9 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_6, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 452, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_inds = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="n">ind0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_inds = (__pyx_v_indf - __pyx_v_ind0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">amp</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_amp;
</pre><pre class="cython line score-0">&#xA0;<span class="">456</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">457</span>:     <span class="c"># &quot;Efficient&quot; Matrix Multiplication</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">458</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_v_n_inds;
  __pyx_t_4 = __pyx_t_5;
  for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_4; __pyx_t_13+=1) {
    __pyx_v_i = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">459</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_14 = 0; __pyx_t_14 &lt; 3; __pyx_t_14+=1) {
      __pyx_v_j = __pyx_t_14;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">460</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">r_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span><span class="w">\</span></pre>
<pre class='cython code score-18 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>}
      __pyx_t_15 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_15 &lt; 0) {
        __pyx_t_15 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>
      }
      __pyx_t_16 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_15 * __pyx_v_inds.strides[0]) )));
      __pyx_t_17 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>
      }
/* â€¦ */
      if (unlikely(!__pyx_v_polymer-&gt;r_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>}
      __pyx_t_20 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_20 &lt; 0) {
        __pyx_t_20 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_20 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>
      }
      __pyx_t_21 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_20 * __pyx_v_inds.strides[0]) )));
      __pyx_t_22 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_21 &lt; 0) {
        __pyx_t_21 += __pyx_v_polymer-&gt;r_trial.shape[0];
        if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_21 &gt;= __pyx_v_polymer-&gt;r_trial.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_22 &lt; 0) {
        __pyx_t_22 += __pyx_v_polymer-&gt;r_trial.shape[1];
        if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_22 &gt;= __pyx_v_polymer-&gt;r_trial.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 460, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r_trial.data + __pyx_t_21 * __pyx_v_polymer-&gt;r_trial.strides[0]) )) + __pyx_t_22)) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_16 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_17)) ))) + (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_18 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_19)) ))));
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>:                 <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-7 '>      if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>}
      __pyx_t_18 = __pyx_v_j;
      __pyx_t_19 = 3;
      __pyx_t_2 = -1;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_19 &lt; 0) {
        __pyx_t_19 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
        if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_19 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t3_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">t3</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-18 '>      if (unlikely(!__pyx_v_polymer-&gt;t3.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>}
      __pyx_t_19 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_19 &lt; 0) {
        __pyx_t_19 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_19 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
      }
      __pyx_t_18 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_19 * __pyx_v_inds.strides[0]) )));
      __pyx_t_15 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_v_polymer-&gt;t3.shape[0];
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_v_polymer-&gt;t3.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_15 &lt; 0) {
        __pyx_t_15 += __pyx_v_polymer-&gt;t3.shape[1];
        if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_polymer-&gt;t3.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;t3_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>}
      __pyx_t_17 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
      }
      __pyx_t_16 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_17 * __pyx_v_inds.strides[0]) )));
      __pyx_t_20 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_v_polymer-&gt;t3_trial.shape[0];
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_20 &lt; 0) {
        __pyx_t_20 += __pyx_v_polymer-&gt;t3_trial.shape[1];
        if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_20 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3_trial.data + __pyx_t_16 * __pyx_v_polymer-&gt;t3_trial.strides[0]) )) + __pyx_t_20)) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3.data + __pyx_t_18 * __pyx_v_polymer-&gt;t3.strides[0]) )) + __pyx_t_15)) )));
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">463</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t2_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">t2</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-18 '>      if (unlikely(!__pyx_v_polymer-&gt;t2.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>}
      __pyx_t_19 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_19 &lt; 0) {
        __pyx_t_19 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_19 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
      }
      __pyx_t_15 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_19 * __pyx_v_inds.strides[0]) )));
      __pyx_t_18 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_15 &lt; 0) {
        __pyx_t_15 += __pyx_v_polymer-&gt;t2.shape[0];
        if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_polymer-&gt;t2.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_v_polymer-&gt;t2.shape[1];
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_v_polymer-&gt;t2.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;t2_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>}
      __pyx_t_17 = __pyx_v_i;
      __pyx_t_2 = -1;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_v_inds.shape[0])) __pyx_t_2 = 0;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
      }
      __pyx_t_20 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_17 * __pyx_v_inds.strides[0]) )));
      __pyx_t_16 = __pyx_v_j;
      __pyx_t_2 = -1;
      if (__pyx_t_20 &lt; 0) {
        __pyx_t_20 += __pyx_v_polymer-&gt;t2_trial.shape[0];
        if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_2 = 0;
      } else if (unlikely(__pyx_t_20 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[0])) __pyx_t_2 = 0;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_v_polymer-&gt;t2_trial.shape[1];
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_2 = 1;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[1])) __pyx_t_2 = 1;
      if (unlikely(__pyx_t_2 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
        <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2_trial.data + __pyx_t_20 * __pyx_v_polymer-&gt;t2_trial.strides[0]) )) + __pyx_t_16)) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2.data + __pyx_t_15 * __pyx_v_polymer-&gt;t2.strides[0]) )) + __pyx_t_18)) )));
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">464</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">466</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">467</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">468</span>: <span class="c"># Tangent Rotation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">469</span>: </pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">470</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">tangent_rotation</span><span class="p">(</span></pre>
<pre class='cython code score-60 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_9tangent_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_tangent_rotation(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_ang;
  long __pyx_v_num_beads_to_move;
  long __pyx_v_num_beads;
  long __pyx_v_n_inds;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("tangent_rotation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("tangent_rotation", __pyx_f[0], 470, 0, <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.tangent_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_9tangent_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_8tangent_rotation[] = "Random bead rotation for a random selection of beads.\n    \n    Notes\n    -----\n    Select a random rotation angle. Then select some random number of beads \n    to rotate, requiring that at least one bead be selected if the move is \n    on. Call `rotate_selected_beads` to generate a random axis of rotation \n    for each bead, update the transformation matrix, and apply the rotation \n    to each selected bead.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object affected by tangent rotation\n    amp_move : double\n        Range of angles allowed for single tangent rotation move\n    amp_bead : int\n        Number of beads to randomly rotate\n\n    Returns\n    -------\n    array_like (M,) of long\n        Indices of M beads affected by the MC move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_9tangent_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("tangent_rotation (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("tangent_rotation", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("tangent_rotation", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "tangent_rotation") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("tangent_rotation", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.tangent_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_8tangent_rotation(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_8tangent_rotation(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("tangent_rotation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("tangent_rotation (wrapper)", __pyx_f[0], 470, 0, <span class='error_goto'>__PYX_ERR(0, 470, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_tangent_rotation(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 470, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 470, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.tangent_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">471</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Random bead rotation for a random selection of beads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">477</span>: <span class="sd">    Select a random rotation angle. Then select some random number of beads </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">478</span>: <span class="sd">    to rotate, requiring that at least one bead be selected if the move is </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>: <span class="sd">    on. Call `rotate_selected_beads` to generate a random axis of rotation </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: <span class="sd">    for each bead, update the transformation matrix, and apply the rotation </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: <span class="sd">    to each selected bead.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: <span class="sd">        Polymer object affected by tangent rotation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: <span class="sd">        Range of angles allowed for single tangent rotation move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">489</span>: <span class="sd">    amp_bead : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">490</span>: <span class="sd">        Number of beads to randomly rotate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">491</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">493</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">494</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">495</span>: <span class="sd">        Indices of M beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">496</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ang</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">num_beads_to_move</span><span class="p">,</span> <span class="nf">num_beads</span><span class="p">,</span> <span class="nf">n_inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">501</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">502</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>:     <span class="n">ang</span> <span class="o">=</span> <span class="n">pick_random_amp</span><span class="p">(</span><span class="n">amp_move</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ang = __pyx_f_6chromo_2mc_10move_funcs_pick_random_amp(__pyx_v_amp_move);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>:     <span class="n">num_beads_to_move</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">amp_bead</span> <span class="o">+</span> <span class="mf">1</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = rand();
  if (unlikely(__pyx_v_amp_bead == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
  }
  __pyx_v_num_beads_to_move = (__Pyx_mod_long(__pyx_t_1, __pyx_v_amp_bead) + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">505</span>:     <span class="n">num_beads</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_polymer-&gt;num_beads;
  __pyx_v_num_beads = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">get_inds</span><span class="p">(</span><span class="n">num_beads</span><span class="p">,</span> <span class="n">num_beads_to_move</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_f_6chromo_2mc_10move_funcs_get_inds(__pyx_v_num_beads, __pyx_v_num_beads_to_move);<span class='error_goto'> if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  __pyx_v_inds = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">num_beads_to_move</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_inds = __pyx_v_num_beads_to_move;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">509</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">ang</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_ang;
</pre><pre class="cython line score-0">&#xA0;<span class="">510</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>:     <span class="c"># Rotate selected beads</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">512</span>:     <span class="n">rotate_select_beads</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_rotate_select_beads(__pyx_v_polymer, __pyx_v_inds, __pyx_v_n_inds, __pyx_v_ang);
</pre><pre class="cython line score-0">&#xA0;<span class="">513</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">515</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">516</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">rotate_select_beads</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_6chromo_2mc_10move_funcs_rotate_select_beads(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, __Pyx_memviewslice __pyx_v_inds, long __pyx_v_n_inds, double __pyx_v_ang) {
  double __pyx_v_ele_t3;
  double __pyx_v_ele_t2;
  long __pyx_v_i;
  long __pyx_v_j;
  long __pyx_v_k;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("rotate_select_beads", 0);
  <span class='trace'>__Pyx_TraceCall</span>("rotate_select_beads", __pyx_f[0], 517, 0, <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.rotate_select_beads", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">518</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="nb">long</span><span class="p">[:]</span> <span class="n">inds</span><span class="p">,</span> <span class="nb">long</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">double</span> <span class="n">ang</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">519</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">520</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate the tangent vector of select beads about a random axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">521</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">522</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">523</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">524</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">525</span>: <span class="sd">        Polymer affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">526</span>: <span class="sd">    inds : long[:]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">527</span>: <span class="sd">        Indices of beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">528</span>: <span class="sd">    n_inds : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">529</span>: <span class="sd">        Number of beads involved in MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">530</span>: <span class="sd">    ang : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">531</span>: <span class="sd">        Angle for which to randomly rotate tangents</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">532</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">533</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">num_points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">534</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ele_t3</span><span class="p">,</span> <span class="nf">ele_t2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">536</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n_inds;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:         <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere_inplace</span><span class="p">(</span><span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 538, __pyx_L1_error)</span>}
    __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere_inplace(__pyx_v_polymer-&gt;direction);
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">539</span>:         <span class="n">la</span><span class="o">.</span><span class="n">arbitrary_axis_rotation</span><span class="p">(</span><span class="n">polymer</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">polymer</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>    if (unlikely(!__pyx_v_polymer-&gt;direction.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 539, __pyx_L1_error)</span>}
    if (unlikely(!__pyx_v_6chromo_2mc_10move_funcs_origin.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("origin"); <span class='error_goto'>__PYX_ERR(0, 539, __pyx_L1_error)</span> }
    __pyx_f_6chromo_4util_6linalg_arbitrary_axis_rotation(__pyx_v_polymer-&gt;direction, __pyx_v_6chromo_2mc_10move_funcs_origin, __pyx_v_ang, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">540</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_4 = 0; __pyx_t_4 &lt; 3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:             <span class="n">ele_t3</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t3 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">542</span>:             <span class="n">ele_t2</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      for (__pyx_t_5 = 0; __pyx_t_5 &lt; 3; __pyx_t_5+=1) {
        __pyx_v_k = __pyx_t_5;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:                 <span class="n">ele_t3</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span><span class="w">\</span></pre>
<pre class='cython code score-7 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 544, __pyx_L1_error)</span>}
        __pyx_t_6 = __pyx_v_j;
        __pyx_t_7 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_6 &lt; 0) {
          __pyx_t_6 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 544, __pyx_L1_error)</span>
        }
/* â€¦ */
        __pyx_v_ele_t3 = (__pyx_v_ele_t3 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_6 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_7)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3.data + __pyx_t_10 * __pyx_v_polymer-&gt;t3.strides[0]) )) + __pyx_t_11)) )))));
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:                     <span class="n">polymer</span><span class="o">.</span><span class="n">t3</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>        if (unlikely(!__pyx_v_polymer-&gt;t3.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_i;
        __pyx_t_8 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
        }
        __pyx_t_10 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_9 * __pyx_v_inds.strides[0]) )));
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_v_polymer-&gt;t3.shape[0];
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_polymer-&gt;t3.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_polymer-&gt;t3.shape[1];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;t3.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
        }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">546</span>:                 <span class="n">ele_t2</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span><span class="w">\</span></pre>
<pre class='cython code score-7 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 546, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_j;
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 546, __pyx_L1_error)</span>
        }
/* â€¦ */
        __pyx_v_ele_t2 = (__pyx_v_ele_t2 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_9 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_11)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2.data + __pyx_t_7 * __pyx_v_polymer-&gt;t2.strides[0]) )) + __pyx_t_6)) )))));
      }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:                     <span class="n">polymer</span><span class="o">.</span><span class="n">t2</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>        if (unlikely(!__pyx_v_polymer-&gt;t2.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>}
        __pyx_t_10 = __pyx_v_i;
        __pyx_t_8 = -1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
        }
        __pyx_t_7 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_10 * __pyx_v_inds.strides[0]) )));
        __pyx_t_6 = __pyx_v_k;
        __pyx_t_8 = -1;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;t2.shape[0];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t2.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_6 &lt; 0) {
          __pyx_t_6 += __pyx_v_polymer-&gt;t2.shape[1];
          if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;t2.shape[1])) __pyx_t_8 = 1;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
          <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
        }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">548</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t3_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t3</span></pre>
<pre class='cython code score-9 '>      if (unlikely(!__pyx_v_polymer-&gt;t3_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 548, __pyx_L1_error)</span>}
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_8 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 548, __pyx_L1_error)</span>
      }
      __pyx_t_6 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_10 * __pyx_v_inds.strides[0]) )));
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_8 = -1;
      if (__pyx_t_6 &lt; 0) {
        __pyx_t_6 += __pyx_v_polymer-&gt;t3_trial.shape[0];
        if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;t3_trial.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 548, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3_trial.data + __pyx_t_6 * __pyx_v_polymer-&gt;t3_trial.strides[0]) )) + __pyx_t_7)) )) = __pyx_v_ele_t3;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t2_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t2</span></pre>
<pre class='cython code score-9 '>      if (unlikely(!__pyx_v_polymer-&gt;t2_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>}
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_8 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_inds.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_inds.shape[0])) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>
      }
      __pyx_t_7 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_10 * __pyx_v_inds.strides[0]) )));
      __pyx_t_6 = __pyx_v_j;
      __pyx_t_8 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;t2_trial.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_6 &lt; 0) {
        __pyx_t_6 += __pyx_v_polymer-&gt;t2_trial.shape[1];
        if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2_trial.data + __pyx_t_7 * __pyx_v_polymer-&gt;t2_trial.strides[0]) )) + __pyx_t_6)) )) = __pyx_v_ele_t2;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">550</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>: </pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">552</span>: <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">get_inds</span><span class="p">(</span><span class="nb">long</span> <span class="n">num_beads</span><span class="p">,</span> <span class="nb">long</span> <span class="n">num_inds</span><span class="p">):</span></pre>
<pre class='cython code score-12 '>static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_get_inds(long __pyx_v_num_beads, long __pyx_v_num_inds) {
  long __pyx_v_ind0;
  int __pyx_v_redraw;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_inds_picked = 0;
  long __pyx_v_i;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_inds", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get_inds", __pyx_f[0], 552, 0, <span class='error_goto'>__PYX_ERR(0, 552, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.get_inds", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_inds_picked);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">553</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw indices for the tangent rotation move.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">554</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">556</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>: <span class="sd">    num_beads : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">558</span>: <span class="sd">        Number of polymer beads from which to draw indices</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">559</span>: <span class="sd">    num_inds : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">560</span>: <span class="sd">        Number of indices to draw</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">561</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">562</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">563</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">564</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>: <span class="sd">        Array of M bead indices for which to apply tangent rotation move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">567</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">ind0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">568</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">redraw</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">569</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>:     <span class="k">cdef</span> <span class="kt">set</span> <span class="nf">inds_picked</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>: </pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">572</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">num_inds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_num_inds);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, ((PyObject *)(&amp;PyInt_Type))) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 572, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_4, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 572, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_inds = __pyx_t_5;
  __pyx_t_5.memview = NULL;
  __pyx_t_5.data = NULL;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>:     <span class="n">inds_picked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span></pre>
<pre class='cython code score-5 '>  __pyx_t_4 = <span class='py_c_api'>PySet_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_v_inds_picked = ((PyObject*)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = __pyx_v_num_inds;
  __pyx_t_7 = __pyx_t_6;
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>:         <span class="n">redraw</span> <span class="o">=</span> <span class="bp">True</span></pre>
<pre class='cython code score-0 '>    __pyx_v_redraw = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>:         <span class="k">while</span> <span class="n">redraw</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    while (1) {
      __pyx_t_9 = (__pyx_v_redraw != 0);
      if (!__pyx_t_9) break;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>:             <span class="n">ind0</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">num_beads</span></pre>
<pre class='cython code score-5 '>      __pyx_t_10 = rand();
      if (unlikely(__pyx_v_num_beads == 0)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
        <span class='error_goto'>__PYX_ERR(0, 577, __pyx_L1_error)</span>
      }
      __pyx_v_ind0 = __Pyx_mod_long(__pyx_t_10, __pyx_v_num_beads);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">578</span>:             <span class="k">if</span> <span class="n">ind0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inds_picked</span><span class="p">:</span></pre>
<pre class='cython code score-5 '>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 578, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_9 = (<span class='pyx_c_api'>__Pyx_PySet_ContainsTF</span>(__pyx_t_4, __pyx_v_inds_picked, Py_NE)); if (unlikely(__pyx_t_9 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 578, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_11 = (__pyx_t_9 != 0);
      if (__pyx_t_11) {
/* â€¦ */
      }
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">579</span>:                 <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind0</span></pre>
<pre class='cython code score-2 '>        __pyx_t_12 = __pyx_v_i;
        __pyx_t_10 = -1;
        if (__pyx_t_12 &lt; 0) {
          __pyx_t_12 += __pyx_v_inds.shape[0];
          if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_10 = 0;
        } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_inds.shape[0])) __pyx_t_10 = 0;
        if (unlikely(__pyx_t_10 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
          <span class='error_goto'>__PYX_ERR(0, 579, __pyx_L1_error)</span>
        }
        *((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_12 * __pyx_v_inds.strides[0]) )) = __pyx_v_ind0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">580</span>:                 <span class="n">inds_picked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ind0</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        __pyx_t_13 = <span class='py_c_api'>PySet_Add</span>(__pyx_v_inds_picked, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 580, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">581</span>:                 <span class="n">redraw</span> <span class="o">=</span> <span class="bp">False</span></pre>
<pre class='cython code score-0 '>        __pyx_v_redraw = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">582</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">583</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">584</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">585</span>: <span class="c"># Full Chain Rotation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">586</span>: </pre>
<pre class="cython line score-63" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">587</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">full_chain_rotation</span><span class="p">(</span></pre>
<pre class='cython code score-63 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_11full_chain_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_full_chain_rotation(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, CYTHON_UNUSED long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_ang;
  double __pyx_v_ele_r;
  double __pyx_v_ele_t3;
  double __pyx_v_ele_t2;
  long __pyx_v_n_inds;
  long __pyx_v_fulcrum_ind;
  __Pyx_memviewslice __pyx_v_axis = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_fulcrum = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_i;
  long __pyx_v_j;
  long __pyx_v_k;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_rotation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("full_chain_rotation", __pyx_f[0], 587, 0, <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_axis, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_fulcrum, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_11full_chain_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_10full_chain_rotation[] = "Rotate an entire polymer about an arbitrary axis.\n    \n    Notes\n    -----\n    This move does not change a polymer's internal configurational (elastic)\n    energy and is only relevant to simulations involving more than one polymer.\n\n    The rotation takes place about a random axis, sampled uniformally from the\n    unit sphere. The fulcrum of the rotation is a random bead of the polymer.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object\n    amp_move : double\n        Maximum amplitude (rotation angle) of the rotation move\n    amp_bead : long\n        Maximum amplitude of the window of beads selected for the move; this \n        attribute is included simply to match the formatting of the other \n        move functions and does not affect the full chain rotation \n\n    Returns\n    -------\n    array_like (N,) of long\n        Indices of beads affected by the MC move (will always be entire polymer)\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_11full_chain_rotation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_rotation (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_rotation", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_rotation", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "full_chain_rotation") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 588, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 588, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_rotation", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 588, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_10full_chain_rotation(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_10full_chain_rotation(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_rotation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("full_chain_rotation (wrapper)", __pyx_f[0], 587, 0, <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_full_chain_rotation(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_rotation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">588</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">590</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate an entire polymer about an arbitrary axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">591</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">592</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">593</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>: <span class="sd">    This move does not change a polymer&#39;s internal configurational (elastic)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>: <span class="sd">    energy and is only relevant to simulations involving more than one polymer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>: <span class="sd">    The rotation takes place about a random axis, sampled uniformally from the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">598</span>: <span class="sd">    unit sphere. The fulcrum of the rotation is a random bead of the polymer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">599</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">600</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">601</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">602</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">603</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">604</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">605</span>: <span class="sd">        Maximum amplitude (rotation angle) of the rotation move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">606</span>: <span class="sd">    amp_bead : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">607</span>: <span class="sd">        Maximum amplitude of the window of beads selected for the move; this </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">608</span>: <span class="sd">        attribute is included simply to match the formatting of the other </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">609</span>: <span class="sd">        move functions and does not affect the full chain rotation </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">610</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">611</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">612</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">613</span>: <span class="sd">    array_like (N,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">614</span>: <span class="sd">        Indices of beads affected by the MC move (will always be entire polymer)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">615</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">616</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">617</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ang</span><span class="p">,</span> <span class="nf">ele_r</span><span class="p">,</span> <span class="nf">ele_t3</span><span class="p">,</span> <span class="nf">ele_t2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">618</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">num_beads</span><span class="p">,</span> <span class="nf">n_inds</span><span class="p">,</span> <span class="nf">fulcrum_ind</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">619</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">states</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">621</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">axis</span><span class="p">,</span> <span class="n">fulcrum</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">622</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">623</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">624</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_polymer-&gt;num_beads;
  __pyx_v_n_inds = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">625</span>:     <span class="n">ang</span> <span class="o">=</span> <span class="n">pick_random_amp</span><span class="p">(</span><span class="n">amp_move</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ang = __pyx_f_6chromo_2mc_10move_funcs_pick_random_amp(__pyx_v_amp_move);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">626</span>:     <span class="n">axis</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere();<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 626, __pyx_L1_error)</span>
  __pyx_v_axis = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">628</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">ang</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_ang;
</pre><pre class="cython line score-0">&#xA0;<span class="">629</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">630</span>:     <span class="c"># Prep for Deterministic Transformation</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:     <span class="n">fulcrum_ind</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-5 '>  __pyx_t_3 = rand();
  if (unlikely(__pyx_v_n_inds == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 631, __pyx_L1_error)</span>
  }
  __pyx_v_fulcrum_ind = __Pyx_mod_long(__pyx_t_3, __pyx_v_n_inds);
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>:     <span class="n">fulcrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* â€¦ */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_n_s_d) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 632, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_tuple__2, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_6, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_fulcrum = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_tuple_);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 632, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>:         <span class="n">fulcrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">fulcrum_ind</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-9 '>    if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 634, __pyx_L1_error)</span>}
    __pyx_t_7 = __pyx_v_fulcrum_ind;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_3 = -1;
    if (__pyx_t_7 &lt; 0) {
      __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[0];
      if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 0;
    } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_3 = 0;
    if (__pyx_t_8 &lt; 0) {
      __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[1];
      if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_3 = 1;
    } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_3 = 1;
    if (unlikely(__pyx_t_3 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
      <span class='error_goto'>__PYX_ERR(0, 634, __pyx_L1_error)</span>
    }
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_3 = -1;
    if (__pyx_t_9 &lt; 0) {
      __pyx_t_9 += __pyx_v_fulcrum.shape[0];
      if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 0;
    } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_fulcrum.shape[0])) __pyx_t_3 = 0;
    if (unlikely(__pyx_t_3 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
      <span class='error_goto'>__PYX_ERR(0, 634, __pyx_L1_error)</span>
    }
    *((double *) ( /* dim=0 */ (__pyx_v_fulcrum.data + __pyx_t_9 * __pyx_v_fulcrum.strides[0]) )) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_7 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_8)) )));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">635</span>:     <span class="n">la</span><span class="o">.</span><span class="n">arbitrary_axis_rotation</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fulcrum</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">polymer</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_4util_6linalg_arbitrary_axis_rotation(__pyx_v_axis, __pyx_v_fulcrum, __pyx_v_ang, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">636</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">637</span>:     <span class="c"># &quot;Efficient&quot; matrix multiplication</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">638</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n_inds;
  __pyx_t_10 = __pyx_t_1;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_i = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_12 = 0; __pyx_t_12 &lt; 3; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>:             <span class="n">ele_r</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_r = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:             <span class="n">ele_t3</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t3 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>:             <span class="n">ele_t2</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_ele_t2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      for (__pyx_t_13 = 0; __pyx_t_13 &lt; 3; __pyx_t_13+=1) {
        __pyx_v_k = __pyx_t_13;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">644</span>:                 <span class="n">ele_r</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 644, __pyx_L1_error)</span>}
        __pyx_t_8 = __pyx_v_j;
        __pyx_t_7 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 644, __pyx_L1_error)</span>
        }
        if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 644, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;r.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_v_polymer-&gt;r.shape[1];
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 644, __pyx_L1_error)</span>
        }
        __pyx_v_ele_r = (__pyx_v_ele_r + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_8 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_7)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_9 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_14)) )))));
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:                 <span class="n">ele_t3</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">polymer</span><span class="o">.</span><span class="n">t3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 645, __pyx_L1_error)</span>}
        __pyx_t_14 = __pyx_v_j;
        __pyx_t_9 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 645, __pyx_L1_error)</span>
        }
        if (unlikely(!__pyx_v_polymer-&gt;t3.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 645, __pyx_L1_error)</span>}
        __pyx_t_7 = __pyx_v_i;
        __pyx_t_8 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;t3.shape[0];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;t3.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_v_polymer-&gt;t3.shape[1];
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;t3.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 645, __pyx_L1_error)</span>
        }
        __pyx_v_ele_t3 = (__pyx_v_ele_t3 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_14 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_9)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3.data + __pyx_t_7 * __pyx_v_polymer-&gt;t3.strides[0]) )) + __pyx_t_8)) )))));
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">646</span>:                 <span class="n">ele_t2</span> <span class="o">+=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">polymer</span><span class="o">.</span><span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>        if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 646, __pyx_L1_error)</span>}
        __pyx_t_8 = __pyx_v_j;
        __pyx_t_7 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_7 &lt; 0) {
          __pyx_t_7 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
          if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 646, __pyx_L1_error)</span>
        }
        if (unlikely(!__pyx_v_polymer-&gt;t2.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 646, __pyx_L1_error)</span>}
        __pyx_t_9 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_k;
        __pyx_t_3 = -1;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_v_polymer-&gt;t2.shape[0];
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 0;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;t2.shape[0])) __pyx_t_3 = 0;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_v_polymer-&gt;t2.shape[1];
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 1;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;t2.shape[1])) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>__PYX_ERR(0, 646, __pyx_L1_error)</span>
        }
        __pyx_v_ele_t2 = (__pyx_v_ele_t2 + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_8 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_7)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2.data + __pyx_t_9 * __pyx_v_polymer-&gt;t2.strides[0]) )) + __pyx_t_14)) )))));
      }
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">647</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">r_trial</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_r</span> <span class="o">+</span> <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>}
      __pyx_t_14 = __pyx_v_j;
      __pyx_t_9 = 3;
      __pyx_t_3 = -1;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 0;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_3 = 0;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 1;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_3 = 1;
      if (unlikely(__pyx_t_3 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
        <span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>
      }
      if (unlikely(!__pyx_v_polymer-&gt;r_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_3 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r_trial.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r_trial.shape[0])) __pyx_t_3 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r_trial.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_3 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r_trial.shape[1])) __pyx_t_3 = 1;
      if (unlikely(__pyx_t_3 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
        <span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r_trial.data + __pyx_t_7 * __pyx_v_polymer-&gt;r_trial.strides[0]) )) + __pyx_t_8)) )) = (__pyx_v_ele_r + (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_14 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_9)) ))));
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">648</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t3_trial</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t3</span></pre>
<pre class='cython code score-7 '>      if (unlikely(!__pyx_v_polymer-&gt;t3_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 648, __pyx_L1_error)</span>}
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_14 = __pyx_v_j;
      __pyx_t_3 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;t3_trial.shape[0];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[0])) __pyx_t_3 = 0;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_polymer-&gt;t3_trial.shape[1];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 1;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;t3_trial.shape[1])) __pyx_t_3 = 1;
      if (unlikely(__pyx_t_3 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
        <span class='error_goto'>__PYX_ERR(0, 648, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t3_trial.data + __pyx_t_9 * __pyx_v_polymer-&gt;t3_trial.strides[0]) )) + __pyx_t_14)) )) = __pyx_v_ele_t3;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">649</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">t2_trial</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele_t2</span></pre>
<pre class='cython code score-7 '>      if (unlikely(!__pyx_v_polymer-&gt;t2_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 649, __pyx_L1_error)</span>}
      __pyx_t_14 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_3 = -1;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_polymer-&gt;t2_trial.shape[0];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_3 = 0;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[0])) __pyx_t_3 = 0;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_polymer-&gt;t2_trial.shape[1];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_3 = 1;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_polymer-&gt;t2_trial.shape[1])) __pyx_t_3 = 1;
      if (unlikely(__pyx_t_3 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
        <span class='error_goto'>__PYX_ERR(0, 649, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;t2_trial.data + __pyx_t_14 * __pyx_v_polymer-&gt;t2_trial.strides[0]) )) + __pyx_t_9)) )) = __pyx_v_ele_t2;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">650</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">651</span>:     <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">all_inds</span></pre>
<pre class='cython code score-5 '>  if (unlikely(!__pyx_v_polymer-&gt;all_inds.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 651, __pyx_L1_error)</span>}
  __PYX_INC_MEMVIEW(&amp;__pyx_v_polymer-&gt;all_inds, 0);
  __pyx_r = __pyx_v_polymer-&gt;all_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">652</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">653</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">654</span>: <span class="c"># Full Chain Translation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">655</span>: </pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">656</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">full_chain_translation</span><span class="p">(</span></pre>
<pre class='cython code score-60 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_13full_chain_translation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_full_chain_translation(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, CYTHON_UNUSED long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_amp;
  long __pyx_v_n_inds;
  long __pyx_v_i;
  long __pyx_v_j;
  __Pyx_memviewslice __pyx_v_direction = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_delta = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_translation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("full_chain_translation", __pyx_f[0], 656, 0, <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_translation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_direction, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_delta, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_13full_chain_translation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_12full_chain_translation[] = "\n    Translate an entire polymer in an arbitrary direction.\n    \n    Notes\n    -----\n    This move does not change a polymer's internal configurational (elastic)\n    enregy and is only relevant to simulations involving more than one polymer.\n\n    The translation occurs in a random direction, sampled uniformally from a\n    unit sphere.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object\n    amp_move : double\n        Maximum amplitude (translation distance) of the slide move\n    amp_bead : long\n        Maximum amplitude of the window of beads selected for the move; this \n        attribute is included simply to match the formatting of the other \n        move functions and does not affect the full chain translation\n\n    Returns\n    -------\n    array_like (N,) of long\n        Indices of beads affected by the MC move (will always be entire polymer)\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_13full_chain_translation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_translation (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_translation", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_translation", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "full_chain_translation") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 658, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 659, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("full_chain_translation", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_translation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 657, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_12full_chain_translation(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_12full_chain_translation(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("full_chain_translation", 0);
  <span class='trace'>__Pyx_TraceCall</span>("full_chain_translation (wrapper)", __pyx_f[0], 656, 0, <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_full_chain_translation(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 656, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 656, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.full_chain_translation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">657</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">658</span>:     <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">659</span>:     <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">660</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">661</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">662</span>: <span class="sd">    Translate an entire polymer in an arbitrary direction.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">663</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">664</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">665</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">666</span>: <span class="sd">    This move does not change a polymer&#39;s internal configurational (elastic)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">667</span>: <span class="sd">    enregy and is only relevant to simulations involving more than one polymer.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">668</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">669</span>: <span class="sd">    The translation occurs in a random direction, sampled uniformally from a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">670</span>: <span class="sd">    unit sphere.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">671</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">672</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">673</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">674</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">675</span>: <span class="sd">        Polymer object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">676</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">677</span>: <span class="sd">        Maximum amplitude (translation distance) of the slide move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">678</span>: <span class="sd">    amp_bead : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">679</span>: <span class="sd">        Maximum amplitude of the window of beads selected for the move; this </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">680</span>: <span class="sd">        attribute is included simply to match the formatting of the other </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">681</span>: <span class="sd">        move functions and does not affect the full chain translation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">682</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">683</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">684</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">685</span>: <span class="sd">    array_like (N,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">686</span>: <span class="sd">        Indices of beads affected by the MC move (will always be entire polymer)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">687</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">688</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">689</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">amp</span><span class="p">,</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">690</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">num_beads</span><span class="p">,</span> <span class="nf">n_inds</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">691</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">692</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">states</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">693</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">direction</span><span class="p">,</span> <span class="n">delta</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">694</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">translation_mat</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">r_try</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">695</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">::</span><span class="mf">1</span><span class="p">,</span> <span class="p">:]</span> <span class="n">r_try_T</span><span class="p">,</span> <span class="n">t3_T</span><span class="p">,</span> <span class="n">t2_T</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">696</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">697</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">698</span>:     <span class="n">amp</span> <span class="o">=</span> <span class="n">amp_move</span> <span class="o">*</span> <span class="p">(&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">RAND_MAX</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = ((double)rand());
  if (unlikely(RAND_MAX == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 698, __pyx_L1_error)</span>
  }
  __pyx_v_amp = (__pyx_v_amp_move * (__pyx_t_1 / RAND_MAX));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">699</span>:     <span class="n">direction</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">uniform_sample_unit_sphere</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6chromo_4util_6linalg_uniform_sample_unit_sphere();<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 699, __pyx_L1_error)</span>
  __pyx_v_direction = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">700</span>:     <span class="n">delta</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">vec_scale3</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">amp</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_6chromo_4util_6linalg_vec_scale3(__pyx_v_direction, __pyx_v_amp);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 700, __pyx_L1_error)</span>
  __pyx_v_delta = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">701</span>:     <span class="n">la</span><span class="o">.</span><span class="n">generate_translation_mat</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">polymer</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_4util_6linalg_generate_translation_mat(__pyx_v_delta, ((struct __pyx_obj_6chromo_8polymers_TransformedObject *)__pyx_v_polymer), 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">702</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_polymer-&gt;num_beads;
  __pyx_v_n_inds = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">703</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">704</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="n">amp</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = __pyx_v_amp;
</pre><pre class="cython line score-0">&#xA0;<span class="">705</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">706</span>:     <span class="c"># &quot;Efficient&quot; Matrix Multiplication</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">707</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_n_inds;
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">708</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_6 = 0; __pyx_t_6 &lt; 3; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">709</span>:             <span class="n">polymer</span><span class="o">.</span><span class="n">r_trial</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span><span class="w">\</span></pre>
<pre class='cython code score-14 '>      if (unlikely(!__pyx_v_polymer-&gt;r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 709, __pyx_L1_error)</span>}
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_9 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_polymer-&gt;r.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;r.shape[0])) __pyx_t_9 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_polymer-&gt;r.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_9 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_polymer-&gt;r.shape[1])) __pyx_t_9 = 1;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
        <span class='error_goto'>__PYX_ERR(0, 709, __pyx_L1_error)</span>
      }
/* â€¦ */
      if (unlikely(!__pyx_v_polymer-&gt;r_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 709, __pyx_L1_error)</span>}
      __pyx_t_12 = __pyx_v_i;
      __pyx_t_13 = __pyx_v_j;
      __pyx_t_9 = -1;
      if (__pyx_t_12 &lt; 0) {
        __pyx_t_12 += __pyx_v_polymer-&gt;r_trial.shape[0];
        if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_polymer-&gt;r_trial.shape[0])) __pyx_t_9 = 0;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_polymer-&gt;r_trial.shape[1];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_9 = 1;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_polymer-&gt;r_trial.shape[1])) __pyx_t_9 = 1;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
        <span class='error_goto'>__PYX_ERR(0, 709, __pyx_L1_error)</span>
      }
      *((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r_trial.data + __pyx_t_12 * __pyx_v_polymer-&gt;r_trial.strides[0]) )) + __pyx_t_13)) )) = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;r.data + __pyx_t_7 * __pyx_v_polymer-&gt;r.strides[0]) )) + __pyx_t_8)) ))) + (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_polymer-&gt;__pyx_base.transformation_mat.data + __pyx_t_10 * __pyx_v_polymer-&gt;__pyx_base.transformation_mat.strides[0]) )) + __pyx_t_11)) ))));
    }
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">710</span>:                 <span class="n">polymer</span><span class="o">.</span><span class="n">transformation_mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-7 '>      if (unlikely(!__pyx_v_polymer-&gt;__pyx_base.transformation_mat.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 710, __pyx_L1_error)</span>}
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 3;
      __pyx_t_9 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[0])) __pyx_t_9 = 0;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1];
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_9 = 1;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_polymer-&gt;__pyx_base.transformation_mat.shape[1])) __pyx_t_9 = 1;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
        <span class='error_goto'>__PYX_ERR(0, 710, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">711</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">712</span>:     <span class="k">return</span> <span class="n">polymer</span><span class="o">.</span><span class="n">all_inds</span></pre>
<pre class='cython code score-5 '>  if (unlikely(!__pyx_v_polymer-&gt;all_inds.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 712, __pyx_L1_error)</span>}
  __PYX_INC_MEMVIEW(&amp;__pyx_v_polymer-&gt;all_inds, 0);
  __pyx_r = __pyx_v_polymer-&gt;all_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">713</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">714</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">715</span>: <span class="c"># Change Binding States</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">716</span>: </pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">717</span>: <span class="k">cpdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">change_binding_state</span><span class="p">(</span></pre>
<pre class='cython code score-66 '>static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_15change_binding_state(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __Pyx_memviewslice __pyx_f_6chromo_2mc_10move_funcs_change_binding_state(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, CYTHON_UNUSED double __pyx_v_amp_move, long __pyx_v_amp_bead, CYTHON_UNUSED int __pyx_skip_dispatch) {
  long __pyx_v_binder_ind;
  long __pyx_v_n_tails;
  long __pyx_v_b_0;
  long __pyx_v_b_1;
  long __pyx_v_ind0;
  long __pyx_v_indf;
  long __pyx_v_n_inds;
  __Pyx_memviewslice __pyx_v_inds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("change_binding_state", 0);
  <span class='trace'>__Pyx_TraceCall</span>("change_binding_state", __pyx_f[0], 717, 0, <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.change_binding_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_inds, 1);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_15change_binding_state(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6chromo_2mc_10move_funcs_14change_binding_state[] = "Flip the binding state of a reader protein.\n    \n    Notes\n    -----\n    Before applying the move, check that the polymer has any reader proteins at\n    all.\n\n    Begin the move by identifying the number of binding sites that each bead\n    has for the particular reader protein. Then randomly select a bead in the\n    chain. Select a second bead from a two sided decaying exponential\n    distribution around the index of the first bead. Replace the binding state\n    of the selected beads.\n\n    In our model, we do not track the binding state of individual tails. We\n    care only about how many tails are bound. Therefore, for each move, we will\n    generate a random order of bound and unbound tails and will flip the state\n    of the first M tails in that order.\n\n    This function assumes that polymers are formed from a single type of bead\n    object. if different types of bead objects exist, then the first two\n    if-statements that reference `bead[0]` will need to be generalized.\n\n    Parameters\n    ----------\n    polymer : poly.PolymerBase\n        Polymer object on which the move is applied\n    amp_move : double\n        Magnitude of the MC move; this attribute is included simply for \n        consistency with the other MC move functions and does not affect the \n        binding state move\n    amp_bead : int\n        Maximum range of beads to which a binding state swap will take palce\n\n    Returns\n    -------\n    array_like (M,) of long\n        Indices of M beads affected by the MC move\n    ";
static PyObject *__pyx_pw_6chromo_2mc_10move_funcs_15change_binding_state(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer = 0;
  double __pyx_v_amp_move;
  long __pyx_v_amp_bead;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("change_binding_state (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_polymer,&amp;__pyx_n_s_amp_move,&amp;__pyx_n_s_amp_bead,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_polymer)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_move)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("change_binding_state", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amp_bead)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("change_binding_state", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "change_binding_state") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_polymer = ((struct __pyx_obj_6chromo_8polymers_PolymerBase *)values[0]);
    __pyx_v_amp_move = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_amp_move == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 718, __pyx_L3_error)</span>
    __pyx_v_amp_bead = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_amp_bead == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 718, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("change_binding_state", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.change_binding_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_polymer), __pyx_ptype_6chromo_8polymers_PolymerBase, 1, "polymer", 0))) <span class='error_goto'>__PYX_ERR(0, 718, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_6chromo_2mc_10move_funcs_14change_binding_state(__pyx_self, __pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6chromo_2mc_10move_funcs_14change_binding_state(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, double __pyx_v_amp_move, long __pyx_v_amp_bead) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("change_binding_state", 0);
  <span class='trace'>__Pyx_TraceCall</span>("change_binding_state (wrapper)", __pyx_f[0], 717, 0, <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_6chromo_2mc_10move_funcs_change_binding_state(__pyx_v_polymer, __pyx_v_amp_move, __pyx_v_amp_bead, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("chromo.mc.move_funcs.change_binding_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">718</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">double</span> <span class="n">amp_move</span><span class="p">,</span> <span class="nb">long</span> <span class="n">amp_bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">719</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">720</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Flip the binding state of a reader protein.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">721</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">722</span>: <span class="sd">    Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">723</span>: <span class="sd">    -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">724</span>: <span class="sd">    Before applying the move, check that the polymer has any reader proteins at</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">725</span>: <span class="sd">    all.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">726</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">727</span>: <span class="sd">    Begin the move by identifying the number of binding sites that each bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">728</span>: <span class="sd">    has for the particular reader protein. Then randomly select a bead in the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">729</span>: <span class="sd">    chain. Select a second bead from a two sided decaying exponential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">730</span>: <span class="sd">    distribution around the index of the first bead. Replace the binding state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">731</span>: <span class="sd">    of the selected beads.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">732</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">733</span>: <span class="sd">    In our model, we do not track the binding state of individual tails. We</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">734</span>: <span class="sd">    care only about how many tails are bound. Therefore, for each move, we will</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">735</span>: <span class="sd">    generate a random order of bound and unbound tails and will flip the state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">736</span>: <span class="sd">    of the first M tails in that order.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">737</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">738</span>: <span class="sd">    This function assumes that polymers are formed from a single type of bead</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">739</span>: <span class="sd">    object. if different types of bead objects exist, then the first two</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">740</span>: <span class="sd">    if-statements that reference `bead[0]` will need to be generalized.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">741</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">742</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">743</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">744</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">745</span>: <span class="sd">        Polymer object on which the move is applied</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">746</span>: <span class="sd">    amp_move : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">747</span>: <span class="sd">        Magnitude of the MC move; this attribute is included simply for </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">748</span>: <span class="sd">        consistency with the other MC move functions and does not affect the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">749</span>: <span class="sd">        binding state move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">750</span>: <span class="sd">    amp_bead : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">751</span>: <span class="sd">        Maximum range of beads to which a binding state swap will take palce</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">752</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">753</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">754</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">755</span>: <span class="sd">    array_like (M,) of long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">756</span>: <span class="sd">        Indices of M beads affected by the MC move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">757</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">758</span>:     <span class="c"># Type Declarations</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">759</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">binder_ind</span><span class="p">,</span> <span class="nf">n_tails</span><span class="p">,</span> <span class="nf">b_0</span><span class="p">,</span> <span class="nf">b_1</span><span class="p">,</span> <span class="nf">ind0</span><span class="p">,</span> <span class="nf">indf</span><span class="p">,</span> <span class="nf">n_inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">760</span>:     <span class="k">cdef</span> <span class="kt">long</span>[<span class="p">:]</span> <span class="n">inds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">761</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">762</span>:     <span class="c"># Stochastic Move Selection</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">763</span>:     <span class="n">binder_ind</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_binders</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = rand();
  if (unlikely(__pyx_v_polymer-&gt;num_binders == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 763, __pyx_L1_error)</span>
  }
  __pyx_v_binder_ind = __Pyx_mod_long(__pyx_t_1, __pyx_v_polymer-&gt;num_binders);
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">764</span>:     <span class="n">n_tails</span> <span class="o">=</span> <span class="n">polymer</span><span class="o">.</span><span class="n">beads</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">.</span><span class="n">binders</span><span class="p">[</span><span class="n">binder_ind</span><span class="p">]</span><span class="o">.</span><span class="n">sites_per_bead</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_polymer-&gt;beads, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 764, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_binders);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 764, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, __pyx_v_binder_ind, long, 1, __Pyx_PyInt_From_long, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 764, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_sites_per_bead);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 764, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_4 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 764, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_n_tails = __pyx_t_4;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">765</span>:     <span class="n">b_0</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = rand();
  if (unlikely(__pyx_v_polymer-&gt;num_beads == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 765, __pyx_L1_error)</span>
  }
  __pyx_v_b_0 = __Pyx_mod_long(__pyx_t_1, __pyx_v_polymer-&gt;num_beads);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">766</span>:     <span class="n">b_1</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">from_point</span><span class="p">(</span><span class="n">amp_bead</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">,</span> <span class="n">b_0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_b_1 = __pyx_f_6chromo_4util_14bead_selection_from_point(__pyx_v_amp_bead, __pyx_v_polymer-&gt;num_beads, __pyx_v_b_0, 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">767</span>:     <span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span> <span class="o">=</span> <span class="n">beads</span><span class="o">.</span><span class="n">check_bead_bounds</span><span class="p">(</span><span class="n">b_0</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">polymer</span><span class="o">.</span><span class="n">num_beads</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_f_6chromo_4util_14bead_selection_check_bead_bounds(__pyx_v_b_0, __pyx_v_b_1, __pyx_v_polymer-&gt;num_beads);
  __pyx_t_4 = __pyx_t_5.f0;
  __pyx_t_6 = __pyx_t_5.f1;
  __pyx_v_ind0 = __pyx_t_4;
  __pyx_v_indf = __pyx_t_6;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">768</span>:     <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind0</span><span class="p">,</span> <span class="n">indf</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_ind0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_indf);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = NULL;
  __pyx_t_1 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      __pyx_t_1 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_2, __pyx_t_8};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_2, __pyx_t_8};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_7, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_1, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_1, __pyx_t_8);
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 768, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_inds = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">769</span>:     <span class="n">n_inds</span> <span class="o">=</span> <span class="n">indf</span> <span class="o">-</span> <span class="n">ind0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_inds = (__pyx_v_indf - __pyx_v_ind0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">770</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_bead</span> <span class="o">=</span> <span class="n">n_inds</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_bead = __pyx_v_n_inds;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">771</span>:     <span class="n">polymer</span><span class="o">.</span><span class="n">last_amp_move</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span> <span class="n">n_tails</span></pre>
<pre class='cython code score-0 '>  __pyx_v_polymer-&gt;last_amp_move = ((double)__pyx_v_n_tails);
</pre><pre class="cython line score-0">&#xA0;<span class="">772</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">773</span>:     <span class="c"># Perform Binding Move</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">774</span>:     <span class="n">conduct_change_binding_states</span><span class="p">(</span><span class="n">polymer</span><span class="p">,</span> <span class="n">n_inds</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">binder_ind</span><span class="p">,</span> <span class="n">n_tails</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_6chromo_2mc_10move_funcs_conduct_change_binding_states(__pyx_v_polymer, __pyx_v_n_inds, __pyx_v_inds, __pyx_v_binder_ind, __pyx_v_n_tails);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">775</span>:     <span class="k">return</span> <span class="n">inds</span></pre>
<pre class='cython code score-0 '>  __PYX_INC_MEMVIEW(&amp;__pyx_v_inds, 0);
  __pyx_r = __pyx_v_inds;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">776</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">777</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">778</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">conduct_change_binding_states</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_6chromo_2mc_10move_funcs_conduct_change_binding_states(struct __pyx_obj_6chromo_8polymers_PolymerBase *__pyx_v_polymer, long __pyx_v_n_inds, __Pyx_memviewslice __pyx_v_inds, long __pyx_v_binder_ind, long __pyx_v_num_tails) {
  long __pyx_v_i;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("conduct_change_binding_states", 0);
  <span class='trace'>__Pyx_TraceCall</span>("conduct_change_binding_states", __pyx_f[0], 778, 0, <span class='error_goto'>__PYX_ERR(0, 778, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.conduct_change_binding_states", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">779</span>:     <span class="n">poly</span><span class="o">.</span><span class="n">PolymerBase</span> <span class="n">polymer</span><span class="p">,</span> <span class="nb">long</span> <span class="n">n_inds</span><span class="p">,</span> <span class="nb">long</span><span class="p">[:]</span> <span class="n">inds</span><span class="p">,</span> <span class="nb">long</span> <span class="n">binder_ind</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">780</span>:     <span class="nb">long</span> <span class="n">num_tails</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">781</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">782</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Get new binding states for the beads affected by the binding state move.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">783</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">784</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">785</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">786</span>: <span class="sd">    polymer : poly.PolymerBase</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">787</span>: <span class="sd">        Polymer object on which the binding state move is applied</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">788</span>: <span class="sd">    n_inds : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">789</span>: <span class="sd">        Number of beads affected by binding state move (equal to `indf`-`ind0`)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">790</span>: <span class="sd">    inds : array_like (M,)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">791</span>: <span class="sd">        Bead indices in the polymer to which the change binding state move is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">792</span>: <span class="sd">        applied</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">793</span>: <span class="sd">    binder_ind : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">794</span>: <span class="sd">        Index of the binder for which the state is being swapped; the value</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">795</span>: <span class="sd">        represents the column of the states array affected by the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">796</span>: <span class="sd">    num_tails : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">797</span>: <span class="sd">        Number of binding sites of the bead for the particular binder being</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">798</span>: <span class="sd">        flipped by the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">799</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">800</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">801</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inds</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_n_inds;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">802</span>:         <span class="n">polymer</span><span class="o">.</span><span class="n">states_trial</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">binder_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_new_state</span><span class="p">(</span><span class="n">num_tails</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>    if (unlikely(!__pyx_v_polymer-&gt;states_trial.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_AttributeError,"Memoryview is not initialized");<span class='error_goto'>__PYX_ERR(0, 802, __pyx_L1_error)</span>}
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = -1;
    if (__pyx_t_4 &lt; 0) {
      __pyx_t_4 += __pyx_v_inds.shape[0];
      if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_inds.shape[0])) __pyx_t_5 = 0;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>__PYX_ERR(0, 802, __pyx_L1_error)</span>
    }
    __pyx_t_6 = (*((long *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_4 * __pyx_v_inds.strides[0]) )));
    __pyx_t_7 = __pyx_v_binder_ind;
    __pyx_t_5 = -1;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_v_polymer-&gt;states_trial.shape[0];
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_polymer-&gt;states_trial.shape[0])) __pyx_t_5 = 0;
    if (__pyx_t_7 &lt; 0) {
      __pyx_t_7 += __pyx_v_polymer-&gt;states_trial.shape[1];
      if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_5 = 1;
    } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_polymer-&gt;states_trial.shape[1])) __pyx_t_5 = 1;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>__PYX_ERR(0, 802, __pyx_L1_error)</span>
    }
    *((long *) ( /* dim=1 */ ((char *) (((long *) ( /* dim=0 */ (__pyx_v_polymer-&gt;states_trial.data + __pyx_t_6 * __pyx_v_polymer-&gt;states_trial.strides[0]) )) + __pyx_t_7)) )) = __pyx_f_6chromo_2mc_10move_funcs_get_new_state(__pyx_v_num_tails);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">803</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">804</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">805</span>: <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">get_new_state</span><span class="p">(</span><span class="nb">long</span> <span class="n">num_tails</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>static long __pyx_f_6chromo_2mc_10move_funcs_get_new_state(long __pyx_v_num_tails) {
  long __pyx_v_new_binding_state;
  long __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_new_state", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get_new_state", __pyx_f[0], 805, 0, <span class='error_goto'>__PYX_ERR(0, 805, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("chromo.mc.move_funcs.get_new_state", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">806</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a next binding state of a bead.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">807</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">808</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">809</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">810</span>: <span class="sd">    num_tails : long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">811</span>: <span class="sd">        Number of tails for the particular binder which may be bound</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">812</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">813</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">814</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">815</span>: <span class="sd">    long</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">816</span>: <span class="sd">        Number of tails that are bound after the move</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">817</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">818</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">new_binding_state</span></pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">819</span>:     <span class="n">new_binding_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">num_tails</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-56 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_num_tails + 1));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_int_0, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_int_0, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (__pyx_t_4) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_5, __pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_5, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 819, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_7 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 819, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_new_binding_state = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">820</span>:     <span class="k">return</span> <span class="n">new_binding_state</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_new_binding_state;
  goto __pyx_L0;
</pre></div></body></html>
